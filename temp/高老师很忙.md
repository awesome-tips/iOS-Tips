一入IAP深似海第二弹
----------
**作者**: [高老师很忙](https://weibo.com/517082456)

之前和大家分享过一次关于IAP的坑，最近又发现了一个新坑😭：通常我们是根据`-(void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(nonnull NSArray<SKPaymentTransaction *> *)transactions`方法回调来确认用户支付成功还是失败，从而进入不同的业务处理；然而我最近苹果会返回错误的回调，用户实际已经支付成功，但是会先收到一次取消支付的回调，然后马上又收到一个支付成功的回调。

针对这种情况，就需要我们在业务上进一步处理，同时还要兼顾之前分享的关于丢单处理的逻辑，防止丢单会涉及一些订单信息的本地存储，之前可能会在收到取消支付回调时删除对应的本地订单信息，这种情况就需要重新补充订单信息。

如果有更好的方案，欢迎一起分享讨论。
