# 2017.12

iOSä¸­çš„mach\_continuous\_time()æ–¹æ³•
------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

`mach_absolute_time()` è¿™ä¸ªå‡½æ•°å¤§å®¶åº”è¯¥æ¯”è¾ƒäº†è§£ï¼šè¿”å›çš„æ˜¯CPUå·²ç»è¿è¡Œçš„æ—¶é’Ÿå‘¨æœŸæ•°ï¼Œå¯ä»¥è½¬åŒ–ä¸ºç§’æ•°ï¼Œè¿™ä¸ªæ˜¯ä¸ä¼šå—æœ¬åœ°æ—¶é—´å½±å“çš„ï¼Œä¸è¿‡å½“æ‰‹æœºé‡å¯ä¼šé‡æ–°å¼€å§‹è®¡æ•°ï¼Œé”å±ä¼‘çœ åä¼šæš‚åœè®¡æ•°ã€‚ä»Šå¤©çœ‹æ–‡æ¡£æƒŠå–œçš„å‘ç°äº† `iOS10` ä¹‹åæä¾›äº† `mach_continuous_time()` æ–¹æ³•ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-1.jpg?raw=true)

æ³¨é‡Šå†™çš„æ˜¯ï¼š

> like mach_absolute_time, but advances during sleep

çªç„¶æ„Ÿè§‰å¥½æƒŠå–œï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹æºç ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-2.jpg?raw=true)

é€šè¿‡ä¼‘çœ æµ‹è¯•ï¼ˆä½¿ç”¨ `iPhone8+` , `iOS11` ,åˆ é™¤æ‰€æœ‰ `APP`, å…³æ‰ç½‘ç»œå’Œè“ç‰™ç­‰ï¼Œå…ˆè¿è¡Œ `demo` è·å–ä¸€ä¸ªæ—¶é—´ï¼Œé”å±è¿‡äº†å‡ ä¸ªå°æ—¶ï¼Œå†æ¬¡è·å–æ—¶é—´)ï¼Œç»“æœæœç„¶å¯å–œï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-3.jpg?raw=true)

ä¸è¿‡é‡å¯åä»ç„¶ä¼šé‡ç½®ã€‚é¡ºä¾¿å†ä»‹ç»ä¸€ä¸‹ `mach_approximate_time()`ï¼Œæ˜¯è·å–ä¸€ä¸ªå¤§çº¦æ—¶é—´ï¼Œæš‚æ—¶æ²¡æœ‰ç”¨è¿‡ï¼Œå¯ä»¥ç®€å•çœ‹ä¸‹æºç ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-4.jpg?raw=true)

æ¯”è¾ƒå¥½ç†è§£ã€‚å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼

objc_getClasså’Œobject_getClass
----

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)

æ˜¨å¤©æ‰“å¼€å¥½ä¹…æ²¡å¼€çš„å…¬ä¼—å·åå°ï¼Œçœ‹åˆ°ä¸€ä¸ªå°ä¼™ä¼´ [@é˜³å…‰ä¸‹çš„å°æ³¡æ²«æ˜Ÿäºº002](https://weibo.com/u/5848750701) ç»™æˆ‘ç•™è¨€ï¼ŒæŒ‡æ­£æˆ‘ä¹‹å‰å†™çš„å…³äºRuntimeçš„[æ–‡ç« ](http://southpeak.github.io/2014/10/25/objective-c-runtime-1/) ä¸­ä¸€ä¸ªé”™è¯¯ä¹‹å¤„ï¼Œå¹¶ä¸ºæ­¤å†™äº†ä¸€ç¯‡[æ–‡ç« ](http://www.jianshu.com/p/d0c6a3efb4d4) åœ¨æ­¤æ„Ÿè°¢ã€‚

è¿™ä¸ªé”™è¯¯æ˜¯å…³äºè·å– `NSObject` çš„å…ƒç±»çš„ `isa` æŒ‡é’ˆçš„é—®é¢˜ã€‚åœ¨æˆ‘çš„æ–‡ç« ä¸­ï¼Œé”™è¯¯çš„ç”¨ `objc_getClass((__bridge void *)[NSObject class])` è¿™ç§æ–¹å¼æ¥è·å–å¯¹è±¡çš„æŒ‡é’ˆã€‚ä»£ç å¦‚ä¸‹ï¼š

```objc
void TestMetaClass(id self, SEL _cmd) {
    NSLog(@"This objcet is %p", self);
    NSLog(@"Class is %@, super class is %@", [self class], [self superclass]);
    Class currentClass = [self class];
    for (int i = 0; i < 4; i++) {
        NSLog(@"Following the isa pointer %d times gives %p", i, currentClass);
        currentClass = objc_getClass((__bridge void *)currentClass);
    }
    NSLog(@"NSObject's class is %p", [NSObject class]);
    NSLog(@"NSObject's meta class is %p", objc_getClass((__bridge void *)[NSObject class]));  // 0x0
}
```

å®é™…ä¸Š `objc_getClass` çš„å‚æ•°æ˜¯ç±»åçš„å­—ç¬¦ä¸²ï¼Œè·å–æŒ‡å®šç±»çš„ç±»å¯¹è±¡ã€‚ä¸Šè¿°ä»£ç ä¸­ `(__bridge void *)[NSObject class])` çš„ç»“æœå¹¶ä¸æ˜¯ç±»åçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ `objc_getClass` å‡½æ•°è¿”å›å€¼çš„ç›¸å½“äºæ˜¯ä¸€ä¸ª `nil`ï¼Œæ‰“å°æŒ‡é’ˆçš„å€¼å°±æ˜¯ `0x0`ã€‚æ‰€ä»¥æ­£ç¡®ä½¿ç”¨ `objc_getClass` çš„æ–¹å¼åº”è¯¥æ˜¯`objc_getClass("NSObject")`ï¼Œå…¶æ•ˆæœä¸ `[NSObject class]` æ˜¯ä¸€æ ·çš„ã€‚

è¦æƒ³è·å– `NSObject` ç±»å¯¹è±¡çš„å…ƒç±»ï¼Œå¯ä»¥ä½¿ç”¨ `object_getClass` å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å‚æ•°æ˜¯ `id` ç±»å‹ï¼Œå³ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡çš„ `Class` ä¿¡æ¯ï¼Œå³å¯¹è±¡çš„ `isa` æŒ‡é’ˆï¼›å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè·å–çš„å°±æ˜¯å…ƒç±»ä¿¡æ¯ã€‚

æ‰€ä»¥æ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼Œ`for` å¾ªç¯ä¸­çš„è¾“å‡ºç»“æœä¹Ÿå°è¯äº† `NSObject` å…ƒç±»çš„isaæŒ‡å‘çš„æ˜¯å…¶æœ¬èº«ã€‚

```objc
void TestMetaClass(id self, SEL _cmd) {
    NSLog(@"This objcet is %p", self);
    NSLog(@"Class is %@, super class is %@", [self class], [self superclass]);
    Class currentClass = [self class];
    for (int i = 0; i < 4; i++) {
        NSLog(@"Following the isa pointer %d times gives %p", i, currentClass);
        currentClass = object_getClass(currentClass);
    }
        
    // Following the isa pointer 0 times gives 0x10048e1f0
    // Following the isa pointer 1 times gives 0x10048e220
    // Following the isa pointer 2 times gives 0x7fff8c8e50f0
    // Following the isa pointer 3 times gives 0x7fff8c8e50f0
    NSLog(@"NSObject's class is %p", [NSObject class]);
    NSLog(@"NSObject's meta class is %p", object_getClass([NSObject class]));      
        
    // NSObject's class is 0x7fff8c8e5140
    // NSObject's meta class is 0x7fff8c8e50f0
}
```

ç”±äºåšå®¢å·²åœæ›´ï¼Œé”™è¯¯ä¹‹å¤„å¯ä»¥åœ¨å¾®åšä¸Šç§ä¿¡ã€‚è¿˜è¯·é˜…è¯»çš„æ—¶å€™ä¸è¦ç›²ä»ã€‚

Gerrit æ˜¯é˜»æŒ¡ä¸äº†ä½ ä½¿ç”¨ SourceTree
----

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

å½“æˆ‘ä»¬æäº¤çš„ä»£ç éœ€è¦ Review çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ° Gerritï¼Œå…·ä½“å…³äº Gerrit çš„ä»‹ç»å¯ä»¥çœ‹ [è¿™é‡Œ]
(https://gerrit-review.googlesource.com/Documentation/) ã€‚ä½¿ç”¨ Gerrit åï¼Œæ‰§è¡Œ `push` æ“ä½œçš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ `git push` å‘½ä»¤ï¼Œä¹Ÿå°±è¯´ä½ ä¸èƒ½ä½¿ç”¨ `SourceTree` çš„ `Push` åŠŸèƒ½ï¼Œåªèƒ½åœ¨ç»ˆç«¯ä¹–ä¹–çš„è¾“å…¥ `git push origin HEAD:refs/for/dev` ã€‚æœ‰äº›åŒå­¦å¯èƒ½ä¼šé—®ï¼Œæˆ‘ç‰¹åˆ«æƒ³ä½¿ç”¨ `SourceTree` ï¼Œä¸æƒ³ä½¿ç”¨ç»ˆç«¯å‘½ä»¤ï¼Œæœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•ï¼Ÿå…¶å®ï¼Œ`SourceTree` æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼šã€è‡ªå®šä¹‰æ“ä½œã€‘ï¼ˆSourceTree -- åå¥½è®¾ç½® -- è‡ªå®šä¹‰æ“ä½œ -- æ·»åŠ ï¼‰ï¼Œå¯¼å…¥äº‹å…ˆå†™å¥½çš„è„šæœ¬ã€‚è¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ªå¿«æ·é”®ï¼ˆè¿™é‡Œè®¾ç½®äº† cmd+pï¼‰ã€‚è„šæœ¬å¦‚ä¸‹ï¼š

```
#!/bin/bash
cd /Users/wangsuyan/Desktop/iOS
git push origin HEAD:refs/for/Dev0.0.1
```

å¤‡æ³¨ï¼šè®°å¾—ç»™è„šæœ¬æ‰§è¡Œæƒé™ã€‚
å¦‚æœä½ æ²¡æœ‰ç»™è‡ªå®šä¹‰çš„æ“ä½œè®¾ç½®å¿«æ·é”®ï¼Œå¯ä»¥é€šè¿‡ã€åŠ¨ä½œ -- è‡ªå®šä¹‰æ“ä½œã€‘é€‰æ‹©æ‰§è¡Œä½ çš„ Actionã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/3-1.jpg?raw=true)

è¿™æ ·ï¼Œå½“ä½  push çš„æ—¶å€™ç›´æ¥ `cmd+p` å³å¯æäº¤ä½ çš„ä»£ç ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ã€‚å½“ç„¶ä½ å¯ä»¥å†™ä¸€äº›å…¶å®ƒçš„è„šæœ¬ï¼Œå¹¶è‡ªå®šä¹‰ä¸º Action ï¼Œæ¥æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚ä½ å¯ä»¥çœ‹æˆ‘ä»¥å‰å†™çš„ [è„šæœ¬æ•™ç¨‹] (http://www.jianshu.com/p/8a975f358de8) ã€‚

æ˜¯è°è°ƒäº†æˆ‘çš„åº•å±‚åº“
----

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

è°ƒè¯•çš„æ—¶å€™ï¼Œå¾€å¾€åº•å±‚åº“ä¼šåŸ‹ä¸€äº› `NSLog` æ¥è°ƒè¯•ï¼Œä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼æ‰“å°å‡ºæ¥çš„å‡½æ•°åç§° `__PRETTY_FUNCTION__` æ˜¯åº•å±‚åº“çš„å‡½æ•°åã€‚

```
#   define LEFLog(fmt, ...) NSLog((@"%s (%d) => " fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__)
```

æ‰“å°æ˜¯è¿™æ ·çš„ï¼š+[Network post] ä¸­æ‰“å°äº† `I am a log`ï¼Œè€Œä¸æ¸…æ¥šæ˜¯è°è°ƒç”¨äº†ã€‚

`+[Network post] (22) => I am a log`

ä½†æ˜¯ï¼Œæˆ‘æƒ³è¦çš„æ˜¯æˆ‘åœ¨æœ€é¡¶å±‚è°ƒç”¨æ—¶çš„å‡½æ•°åï¼Œè¿™æ ·æˆ‘å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°æ˜¯é‚£ä¸ªæ–¹æ³•è°ƒç”¨äº†åº•å±‚åº“ã€‚

ä¸å¤ªç†è§£ï¼Ÿä¸¾ä¸ªä¾‹å­å§ï¼š
æ¯ä¸ª APP éƒ½ä¼šæœ‰ä¸€ä¸ªç½‘ç»œå±‚ï¼Œä¸šåŠ¡å±‚ä¼šç›´æ¥ä¸ç½‘ç»œå±‚è¿›è¡Œäº¤äº’ã€‚è°ƒè¯•çš„æ—¶å€™ï¼Œæˆ‘æƒ³çŸ¥é“ A è¯·æ±‚æ˜¯åœ¨å“ªä¸ªé¡µé¢ä¸­çš„å“ªä¸ªå‡½æ•°è¢«è°ƒç”¨äº†ï¼Œå’‹ä¹ˆåŠï¼Ÿå‰ææ˜¯ `NSLog` åœ¨åº•å±‚åº“ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š

```
@implementation LEFLog
+ (NSString *)lastCallMethod
{
    NSArray *symbols = [NSThread callStackSymbols];
    NSInteger maxCount = symbols.count;
    NSString *secondSymbol = maxCount > 2 ? symbols[2] : (maxCount > 1 ? symbols[1] : [symbols firstObject]);
    if (secondSymbol.length == 0) {
        return @"";
    }
    
    NSString *pattern = @"[+-]\\[.{0,}\\]";
    NSError *error;
    NSRegularExpression *express = [NSRegularExpression regularExpressionWithPattern:pattern options:kNilOptions error:&error];
    if (error) {
        NSLog(@"Error: %@", error);
        return @"";
    }
    
    NSTextCheckingResult *checkResult = [[express matchesInString:secondSymbol options:NSMatchingReportCompletion range:NSMakeRange(0, secondSymbol.length)] lastObject];
    NSString *findStr = [secondSymbol substringWithRange:checkResult.range];
    return findStr ?: @"";
}

@end
```

ç„¶åå®šä¹‰ä¸€ä¸ªå®ï¼š

```
#   define LEFLog(fmt, ...) NSLog((@"%@, %s (%d) => " fmt), [LEFLog lastCallMethod], __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__
```

æ‰“å°ç»“æœæ˜¯è¿™æ ·çš„ï¼šåœ¨ `LefexViewController`  ä¸­çš„ `viewDidLoad` è°ƒç”¨äº† `Network ` çš„ `post` æ–¹æ³•ï¼Œå¹¶æ‰“å° `I am a log`.

```
-[LefexViewController viewDidLoad], +[Network post] (22) => I am a log
```

æŒ‡å®šæ„é€ å™¨åœ¨ UITableViewController ä¸­çš„å‘
----
**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰æŒ‡å®šæ„é€ å™¨æ—¶ï¼Œåº”è¯¥è¦éµå¾ªä»¥ä¸‹3ä¸ªåŸåˆ™(å›¾1)ï¼š
1ã€å­ç±»æŒ‡å®šæ„é€ å™¨å¿…é¡»è°ƒç”¨çˆ¶ç±»æŒ‡å®šæ„é€ å™¨
2ã€ä¾¿æ·æ„é€ å™¨åªèƒ½é€šè¿‡è°ƒç”¨è‡ªèº«æŒ‡å®šæ„é€ å™¨æ¥å®Œæˆåˆå§‹åŒ–
3ã€æŒ‡å®šæ„é€ å™¨å¿…é¡»è¦ç”¨ `NS_DESIGNATED_INITIALIZER` æ ‡ç¤º
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/5-1.jpg?raw=true)
ä½†æ˜¯å¦‚æœä½ ç»§æ‰¿äº† UITableViewControllerï¼Œå¹¶ä¸”è‡ªå®šä¹‰äº†æŒ‡å®šæ„é€ å™¨ï¼Œè€Œä½ çš„é¡¹ç›®åˆšå¥½è¦æ”¯æŒ iOS8 çš„è¯ï¼Œåœ¨ iOS8 ä¸‹å°±ä¼šå‡ºç°ä¸€ä¸ªå¿…å´©çš„ bugã€‚ç¤ºä¾‹ä»£ç åŠç®€å•è§£é‡Šè§å›¾2ã€‚
æœ‰äººæäº†å¯¹åº”çš„ radar http://www.openradar.me/23709930ï¼Œ stackoverflow ä¸Šä¹Ÿæœ‰å¯¹åº”çš„è¯¦å°½è§£é‡Š https://stackoverflow.com/a/30719434 æ›´å¤šå†…å®¹å¯æŸ¥çœ‹ http://t.cn/RX978vi
ç›®å‰å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ç»§æ‰¿ UITableViewControllerï¼Œè€Œæ˜¯ç»§æ‰¿è‡ª UIViewController ç„¶åæŒæœ‰ä¸€ä¸ª UITableViewğŸ˜‚
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/5-2.jpg?raw=true)


ä¸ºæ–­ç‚¹åŠ æ¡ä»¶å’Œç®€å•å‘½ä»¤
----

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

ä»Šå¤©ä¸»è¦ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªå¦‚ä½•ç»™æ–­ç‚¹åŠ æ¡ä»¶å’Œå‘½ä»¤æ¥æé«˜æˆ‘ä»¬çš„è°ƒè¯•æ•ˆç‡ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªforå¾ªç¯ï¼Œåœ¨ç¬¬næ¬¡å¾ªç¯çš„æ—¶å€™æœ‰ä¸€ä¸ªbugï¼Œè¿™ä¸ªæ—¶å€™æ¡ä»¶æ–­ç‚¹å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œé€šè¿‡å³å‡»æ–­ç‚¹ï¼Œé€‰æ‹©ç¼–è¾‘æ–­ç‚¹ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-1.jpg?raw=true)

æˆ‘ä»¬å¯ä»¥è®¾ç½®`Conditionï¼ši= n`ï¼Œç›´æ¥æ–­åˆ°æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„é‚£æ¬¡å¾ªç¯ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-2.jpg?raw=true)

æˆ–è€…ä¹Ÿå¯ä»¥ç”¨`Ignore`åŠŸèƒ½æ¥è®¾ç½®å¿½ç•¥å‰é¢ä¸å…³å¿ƒçš„å¾ªç¯ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-3.jpg?raw=true)

é€šè¿‡è®¾ç½®ActionåŠŸèƒ½è¿˜å¯ä»¥åœ¨æ–­ç‚¹å¤„æ‰§è¡Œä¸€äº›ç®€å•çš„å‘½ä»¤ã€æ‰“å°æ—¥å¿—ã€æ’­æ”¾å£°éŸ³ã€æ‰§è¡Œè„šæœ¬ç­‰ï¼Œ

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-4.jpg?raw=true)

è®©è°ƒè¯•å˜çš„æ¬¢ä¹èµ·æ¥å§ï¼

