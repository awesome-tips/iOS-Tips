# 2017.12

iOSä¸­çš„mach\_continuous\_time()æ–¹æ³•
------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

`mach_absolute_time()` è¿™ä¸ªå‡½æ•°å¤§å®¶åº”è¯¥æ¯”è¾ƒäº†è§£ï¼šè¿”å›çš„æ˜¯CPUå·²ç»è¿è¡Œçš„æ—¶é’Ÿå‘¨æœŸæ•°ï¼Œå¯ä»¥è½¬åŒ–ä¸ºç§’æ•°ï¼Œè¿™ä¸ªæ˜¯ä¸ä¼šå—æœ¬åœ°æ—¶é—´å½±å“çš„ï¼Œä¸è¿‡å½“æ‰‹æœºé‡å¯ä¼šé‡æ–°å¼€å§‹è®¡æ•°ï¼Œé”å±ä¼‘çœ åä¼šæš‚åœè®¡æ•°ã€‚ä»Šå¤©çœ‹æ–‡æ¡£æƒŠå–œçš„å‘ç°äº† `iOS10` ä¹‹åæä¾›äº† `mach_continuous_time()` æ–¹æ³•ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-1.jpg?raw=true)

æ³¨é‡Šå†™çš„æ˜¯ï¼š

> like mach_absolute_time, but advances during sleep

çªç„¶æ„Ÿè§‰å¥½æƒŠå–œï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹æºç ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-2.jpg?raw=true)

é€šè¿‡ä¼‘çœ æµ‹è¯•ï¼ˆä½¿ç”¨ `iPhone8+` , `iOS11` ,åˆ é™¤æ‰€æœ‰ `APP`, å…³æ‰ç½‘ç»œå’Œè“ç‰™ç­‰ï¼Œå…ˆè¿è¡Œ `demo` è·å–ä¸€ä¸ªæ—¶é—´ï¼Œé”å±è¿‡äº†å‡ ä¸ªå°æ—¶ï¼Œå†æ¬¡è·å–æ—¶é—´)ï¼Œç»“æœæœç„¶å¯å–œï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-3.jpg?raw=true)

ä¸è¿‡é‡å¯åä»ç„¶ä¼šé‡ç½®ã€‚é¡ºä¾¿å†ä»‹ç»ä¸€ä¸‹ `mach_approximate_time()`ï¼Œæ˜¯è·å–ä¸€ä¸ªå¤§çº¦æ—¶é—´ï¼Œæš‚æ—¶æ²¡æœ‰ç”¨è¿‡ï¼Œå¯ä»¥ç®€å•çœ‹ä¸‹æºç ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/1-4.jpg?raw=true)

æ¯”è¾ƒå¥½ç†è§£ã€‚å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼

objc_getClasså’Œobject_getClass
----

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)

æ˜¨å¤©æ‰“å¼€å¥½ä¹…æ²¡å¼€çš„å…¬ä¼—å·åå°ï¼Œçœ‹åˆ°ä¸€ä¸ªå°ä¼™ä¼´ [@é˜³å…‰ä¸‹çš„å°æ³¡æ²«æ˜Ÿäºº002](https://weibo.com/u/5848750701) ç»™æˆ‘ç•™è¨€ï¼ŒæŒ‡æ­£æˆ‘ä¹‹å‰å†™çš„å…³äºRuntimeçš„[æ–‡ç« ](http://southpeak.github.io/2014/10/25/objective-c-runtime-1/) ä¸­ä¸€ä¸ªé”™è¯¯ä¹‹å¤„ï¼Œå¹¶ä¸ºæ­¤å†™äº†ä¸€ç¯‡[æ–‡ç« ](http://www.jianshu.com/p/d0c6a3efb4d4) åœ¨æ­¤æ„Ÿè°¢ã€‚

è¿™ä¸ªé”™è¯¯æ˜¯å…³äºè·å– `NSObject` çš„å…ƒç±»çš„ `isa` æŒ‡é’ˆçš„é—®é¢˜ã€‚åœ¨æˆ‘çš„æ–‡ç« ä¸­ï¼Œé”™è¯¯çš„ç”¨ `objc_getClass((__bridge void *)[NSObject class])` è¿™ç§æ–¹å¼æ¥è·å–å¯¹è±¡çš„æŒ‡é’ˆã€‚ä»£ç å¦‚ä¸‹ï¼š

```objc
void TestMetaClass(id self, SEL _cmd) {
    NSLog(@"This objcet is %p", self);
    NSLog(@"Class is %@, super class is %@", [self class], [self superclass]);
    Class currentClass = [self class];
    for (int i = 0; i < 4; i++) {
        NSLog(@"Following the isa pointer %d times gives %p", i, currentClass);
        currentClass = objc_getClass((__bridge void *)currentClass);
    }
    NSLog(@"NSObject's class is %p", [NSObject class]);
    NSLog(@"NSObject's meta class is %p", objc_getClass((__bridge void *)[NSObject class]));  // 0x0
}
```

å®é™…ä¸Š `objc_getClass` çš„å‚æ•°æ˜¯ç±»åçš„å­—ç¬¦ä¸²ï¼Œè·å–æŒ‡å®šç±»çš„ç±»å¯¹è±¡ã€‚ä¸Šè¿°ä»£ç ä¸­ `(__bridge void *)[NSObject class])` çš„ç»“æœå¹¶ä¸æ˜¯ç±»åçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ `objc_getClass` å‡½æ•°è¿”å›å€¼çš„ç›¸å½“äºæ˜¯ä¸€ä¸ª `nil`ï¼Œæ‰“å°æŒ‡é’ˆçš„å€¼å°±æ˜¯ `0x0`ã€‚æ‰€ä»¥æ­£ç¡®ä½¿ç”¨ `objc_getClass` çš„æ–¹å¼åº”è¯¥æ˜¯`objc_getClass("NSObject")`ï¼Œå…¶æ•ˆæœä¸ `[NSObject class]` æ˜¯ä¸€æ ·çš„ã€‚

è¦æƒ³è·å– `NSObject` ç±»å¯¹è±¡çš„å…ƒç±»ï¼Œå¯ä»¥ä½¿ç”¨ `object_getClass` å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å‚æ•°æ˜¯ `id` ç±»å‹ï¼Œå³ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡çš„ `Class` ä¿¡æ¯ï¼Œå³å¯¹è±¡çš„ `isa` æŒ‡é’ˆï¼›å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè·å–çš„å°±æ˜¯å…ƒç±»ä¿¡æ¯ã€‚

æ‰€ä»¥æ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼Œ`for` å¾ªç¯ä¸­çš„è¾“å‡ºç»“æœä¹Ÿå°è¯äº† `NSObject` å…ƒç±»çš„isaæŒ‡å‘çš„æ˜¯å…¶æœ¬èº«ã€‚

```objc
void TestMetaClass(id self, SEL _cmd) {
    NSLog(@"This objcet is %p", self);
    NSLog(@"Class is %@, super class is %@", [self class], [self superclass]);
    Class currentClass = [self class];
    for (int i = 0; i < 4; i++) {
        NSLog(@"Following the isa pointer %d times gives %p", i, currentClass);
        currentClass = object_getClass(currentClass);
    }
        
    // Following the isa pointer 0 times gives 0x10048e1f0
    // Following the isa pointer 1 times gives 0x10048e220
    // Following the isa pointer 2 times gives 0x7fff8c8e50f0
    // Following the isa pointer 3 times gives 0x7fff8c8e50f0
    NSLog(@"NSObject's class is %p", [NSObject class]);
    NSLog(@"NSObject's meta class is %p", object_getClass([NSObject class]));      
        
    // NSObject's class is 0x7fff8c8e5140
    // NSObject's meta class is 0x7fff8c8e50f0
}
```

ç”±äºåšå®¢å·²åœæ›´ï¼Œé”™è¯¯ä¹‹å¤„å¯ä»¥åœ¨å¾®åšä¸Šç§ä¿¡ã€‚è¿˜è¯·é˜…è¯»çš„æ—¶å€™ä¸è¦ç›²ä»ã€‚

Gerrit æ˜¯é˜»æŒ¡ä¸äº†ä½ ä½¿ç”¨ SourceTree
----

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

å½“æˆ‘ä»¬æäº¤çš„ä»£ç éœ€è¦ Review çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ° Gerritï¼Œå…·ä½“å…³äº Gerrit çš„ä»‹ç»å¯ä»¥çœ‹ [è¿™é‡Œ]
(https://gerrit-review.googlesource.com/Documentation/) ã€‚ä½¿ç”¨ Gerrit åï¼Œæ‰§è¡Œ `push` æ“ä½œçš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ `git push` å‘½ä»¤ï¼Œä¹Ÿå°±è¯´ä½ ä¸èƒ½ä½¿ç”¨ `SourceTree` çš„ `Push` åŠŸèƒ½ï¼Œåªèƒ½åœ¨ç»ˆç«¯ä¹–ä¹–çš„è¾“å…¥ `git push origin HEAD:refs/for/dev` ã€‚æœ‰äº›åŒå­¦å¯èƒ½ä¼šé—®ï¼Œæˆ‘ç‰¹åˆ«æƒ³ä½¿ç”¨ `SourceTree` ï¼Œä¸æƒ³ä½¿ç”¨ç»ˆç«¯å‘½ä»¤ï¼Œæœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•ï¼Ÿå…¶å®ï¼Œ`SourceTree` æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼šã€è‡ªå®šä¹‰æ“ä½œã€‘ï¼ˆSourceTree -- åå¥½è®¾ç½® -- è‡ªå®šä¹‰æ“ä½œ -- æ·»åŠ ï¼‰ï¼Œå¯¼å…¥äº‹å…ˆå†™å¥½çš„è„šæœ¬ã€‚è¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ªå¿«æ·é”®ï¼ˆè¿™é‡Œè®¾ç½®äº† cmd+pï¼‰ã€‚è„šæœ¬å¦‚ä¸‹ï¼š

```
#!/bin/bash
cd /Users/wangsuyan/Desktop/iOS
git push origin HEAD:refs/for/Dev0.0.1
```

å¤‡æ³¨ï¼šè®°å¾—ç»™è„šæœ¬æ‰§è¡Œæƒé™ã€‚
å¦‚æœä½ æ²¡æœ‰ç»™è‡ªå®šä¹‰çš„æ“ä½œè®¾ç½®å¿«æ·é”®ï¼Œå¯ä»¥é€šè¿‡ã€åŠ¨ä½œ -- è‡ªå®šä¹‰æ“ä½œã€‘é€‰æ‹©æ‰§è¡Œä½ çš„ Actionã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/3-1.jpg?raw=true)

è¿™æ ·ï¼Œå½“ä½  push çš„æ—¶å€™ç›´æ¥ `cmd+p` å³å¯æäº¤ä½ çš„ä»£ç ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ã€‚å½“ç„¶ä½ å¯ä»¥å†™ä¸€äº›å…¶å®ƒçš„è„šæœ¬ï¼Œå¹¶è‡ªå®šä¹‰ä¸º Action ï¼Œæ¥æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚ä½ å¯ä»¥çœ‹æˆ‘ä»¥å‰å†™çš„ [è„šæœ¬æ•™ç¨‹] (http://www.jianshu.com/p/8a975f358de8) ã€‚

æ˜¯è°è°ƒäº†æˆ‘çš„åº•å±‚åº“
----

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

è°ƒè¯•çš„æ—¶å€™ï¼Œå¾€å¾€åº•å±‚åº“ä¼šåŸ‹ä¸€äº› `NSLog` æ¥è°ƒè¯•ï¼Œä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼æ‰“å°å‡ºæ¥çš„å‡½æ•°åç§° `__PRETTY_FUNCTION__` æ˜¯åº•å±‚åº“çš„å‡½æ•°åã€‚

```c
#   define LEFLog(fmt, ...) NSLog((@"%s (%d) => " fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__)
```

æ‰“å°æ˜¯è¿™æ ·çš„ï¼š+[Network post] ä¸­æ‰“å°äº† `I am a log`ï¼Œè€Œä¸æ¸…æ¥šæ˜¯è°è°ƒç”¨äº†ã€‚

`+[Network post] (22) => I am a log`

ä½†æ˜¯ï¼Œæˆ‘æƒ³è¦çš„æ˜¯æˆ‘åœ¨æœ€é¡¶å±‚è°ƒç”¨æ—¶çš„å‡½æ•°åï¼Œè¿™æ ·æˆ‘å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°æ˜¯é‚£ä¸ªæ–¹æ³•è°ƒç”¨äº†åº•å±‚åº“ã€‚

ä¸å¤ªç†è§£ï¼Ÿä¸¾ä¸ªä¾‹å­å§ï¼š
æ¯ä¸ª APP éƒ½ä¼šæœ‰ä¸€ä¸ªç½‘ç»œå±‚ï¼Œä¸šåŠ¡å±‚ä¼šç›´æ¥ä¸ç½‘ç»œå±‚è¿›è¡Œäº¤äº’ã€‚è°ƒè¯•çš„æ—¶å€™ï¼Œæˆ‘æƒ³çŸ¥é“ A è¯·æ±‚æ˜¯åœ¨å“ªä¸ªé¡µé¢ä¸­çš„å“ªä¸ªå‡½æ•°è¢«è°ƒç”¨äº†ï¼Œå’‹ä¹ˆåŠï¼Ÿå‰ææ˜¯ `NSLog` åœ¨åº•å±‚åº“ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š

```objc
@implementation LEFLog
+ (NSString *)lastCallMethod
{
    NSArray *symbols = [NSThread callStackSymbols];
    NSInteger maxCount = symbols.count;
    NSString *secondSymbol = maxCount > 2 ? symbols[2] : (maxCount > 1 ? symbols[1] : [symbols firstObject]);
    if (secondSymbol.length == 0) {
        return @"";
    }
    
    NSString *pattern = @"[+-]\\[.{0,}\\]";
    NSError *error;
    NSRegularExpression *express = [NSRegularExpression regularExpressionWithPattern:pattern options:kNilOptions error:&error];
    if (error) {
        NSLog(@"Error: %@", error);
        return @"";
    }
    
    NSTextCheckingResult *checkResult = [[express matchesInString:secondSymbol options:NSMatchingReportCompletion range:NSMakeRange(0, secondSymbol.length)] lastObject];
    NSString *findStr = [secondSymbol substringWithRange:checkResult.range];
    return findStr ?: @"";
}

@end
```

ç„¶åå®šä¹‰ä¸€ä¸ªå®ï¼š

```c
#   define LEFLog(fmt, ...) NSLog((@"%@, %s (%d) => " fmt), [LEFLog lastCallMethod], __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__
```

æ‰“å°ç»“æœæ˜¯è¿™æ ·çš„ï¼šåœ¨ `LefexViewController`  ä¸­çš„ `viewDidLoad` è°ƒç”¨äº† `Network ` çš„ `post` æ–¹æ³•ï¼Œå¹¶æ‰“å° `I am a log`.

```objc
-[LefexViewController viewDidLoad], +[Network post] (22) => I am a log
```

æŒ‡å®šæ„é€ å™¨åœ¨ UITableViewController ä¸­çš„å‘
----
**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰æŒ‡å®šæ„é€ å™¨æ—¶ï¼Œåº”è¯¥è¦éµå¾ªä»¥ä¸‹3ä¸ªåŸåˆ™(å›¾1)ï¼š
1ã€å­ç±»æŒ‡å®šæ„é€ å™¨å¿…é¡»è°ƒç”¨çˆ¶ç±»æŒ‡å®šæ„é€ å™¨
2ã€ä¾¿æ·æ„é€ å™¨åªèƒ½é€šè¿‡è°ƒç”¨è‡ªèº«æŒ‡å®šæ„é€ å™¨æ¥å®Œæˆåˆå§‹åŒ–
3ã€æŒ‡å®šæ„é€ å™¨å¿…é¡»è¦ç”¨ `NS_DESIGNATED_INITIALIZER` æ ‡ç¤º
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/5-1.jpg?raw=true)
ä½†æ˜¯å¦‚æœä½ ç»§æ‰¿äº† UITableViewControllerï¼Œå¹¶ä¸”è‡ªå®šä¹‰äº†æŒ‡å®šæ„é€ å™¨ï¼Œè€Œä½ çš„é¡¹ç›®åˆšå¥½è¦æ”¯æŒ iOS8 çš„è¯ï¼Œåœ¨ iOS8 ä¸‹å°±ä¼šå‡ºç°ä¸€ä¸ªå¿…å´©çš„ bugã€‚ç¤ºä¾‹ä»£ç åŠç®€å•è§£é‡Šè§å›¾2ã€‚
æœ‰äººæäº†å¯¹åº”çš„ [radar](http://www.openradar.me/23709930)ï¼Œ stackoverflow ä¸Šä¹Ÿæœ‰å¯¹åº”çš„[è¯¦å°½è§£é‡Š](https://stackoverflow.com/a/30719434) æ›´å¤šå†…å®¹å¯[æŸ¥çœ‹](http://t.cn/RX978vi)
ç›®å‰å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ç»§æ‰¿ UITableViewControllerï¼Œè€Œæ˜¯ç»§æ‰¿è‡ª UIViewController ç„¶åæŒæœ‰ä¸€ä¸ª UITableViewğŸ˜‚
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/5-2.jpg?raw=true)


ä¸ºæ–­ç‚¹åŠ æ¡ä»¶å’Œç®€å•å‘½ä»¤
----

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

ä»Šå¤©ä¸»è¦ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªå¦‚ä½•ç»™æ–­ç‚¹åŠ æ¡ä»¶å’Œå‘½ä»¤æ¥æé«˜æˆ‘ä»¬çš„è°ƒè¯•æ•ˆç‡ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªforå¾ªç¯ï¼Œåœ¨ç¬¬næ¬¡å¾ªç¯çš„æ—¶å€™æœ‰ä¸€ä¸ªbugï¼Œè¿™ä¸ªæ—¶å€™æ¡ä»¶æ–­ç‚¹å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œé€šè¿‡å³å‡»æ–­ç‚¹ï¼Œé€‰æ‹©ç¼–è¾‘æ–­ç‚¹ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-1.jpg?raw=true)

æˆ‘ä»¬å¯ä»¥è®¾ç½®`Conditionï¼ši= n`ï¼Œç›´æ¥æ–­åˆ°æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„é‚£æ¬¡å¾ªç¯ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-2.jpg?raw=true)

æˆ–è€…ä¹Ÿå¯ä»¥ç”¨`Ignore`åŠŸèƒ½æ¥è®¾ç½®å¿½ç•¥å‰é¢ä¸å…³å¿ƒçš„å¾ªç¯ï¼›

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-3.jpg?raw=true)

é€šè¿‡è®¾ç½®ActionåŠŸèƒ½è¿˜å¯ä»¥åœ¨æ–­ç‚¹å¤„æ‰§è¡Œä¸€äº›ç®€å•çš„å‘½ä»¤ã€æ‰“å°æ—¥å¿—ã€æ’­æ”¾å£°éŸ³ã€æ‰§è¡Œè„šæœ¬ç­‰ï¼Œ

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/6-4.jpg?raw=true)

è®©è°ƒè¯•å˜çš„æ¬¢ä¹èµ·æ¥å§ï¼

SourceTree æ­é… Kaleidoscope è¿›è¡Œ Code Review
----

å¹³æ—¶åœ¨ `Gitlab`ã€`GitHub`ã€`SourceTree` ä¸Šè¿›è¡Œ `CodeReview` çš„æ—¶å€™ï¼Œåªèƒ½çœ‹åˆ°å‘ç”Ÿæ”¹åŠ¨çš„åœ°æ–¹ï¼Œæƒ³è¦æŸ¥çœ‹æ”¹åŠ¨ç‚¹å¯¹åº”çš„ä¸Šä¸‹æ–‡æ—¶éå¸¸éº»çƒ¦(ç½‘é¡µä¸Šè¦ä¸æ–­çš„ç‚¹å±•å¼€)ã€‚ä»Šå¤©ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªæˆ‘ä»¬å°ç»„å†… `CodeReview` æ—¶ç”¨åˆ°çš„å·¥å…·åŠå…¶é…ç½®ï¼Œå¦‚æœä½ æœ‰å…¶å®ƒæ–¹å¼ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµæ¢è®¨ã€‚ç¡®ä¿é…ç½®å‰å·²å®‰è£…å¥½ `SourceTree` ä»¥åŠ `Kaleidoscope`ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹

* ç‚¹å‡» `Kaleidoscope` èœå• â€“> ç‚¹å‡» `Integration` â€“> ä¸‹è½½ `ksdiff`ï¼ˆç‚¹å‡» `Read More`ï¼‰

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/7-1.jpg?raw=true)

* å®‰è£…å®Œæˆä¹‹åï¼Œåˆ é™¤ `~/.gitconfig` æ–‡ä»¶ä¸­ `difftool` ä¸ `mergetool` ç›¸å…³é…ç½®ï¼ˆåˆ ä¹‹å‰æœ€å¥½å¤‡ä»½ä¸€ä¸‹åŸæ–‡ä»¶ï¼‰

* æ‰“å¼€ `SourceTree` çš„åå¥½è®¾ç½®ï¼ŒæŒ‰ä¸‹å›¾çš„æ–¹å¼é…ç½®ã€‚ä¸¤å¤„ `Command` éƒ½å¡« `/usr/local/bin/ksdiff`ï¼Œ`Argument` åˆ†åˆ«ä¸º `--partial-changeset --relative-path "$MERGED" -- "$LOCAL" "$REMOTE"` ã€`--merge --output "$MERGED" --base "$BASE" -- "$LOCAL" --snapshot "$REMOTE" --snapshot`ã€‚è¿™ä¸¤ä¸ªå‚æ•°ä¹Ÿå¯ä»¥æŒ‰è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/7-2.jpg?raw=true)

* ä»¥ä¸Šè®¾ç½®å®Œæˆä¹‹åå¯ä»¥ç»™ `SourceTree` åŠ ä¸€ä¸ªè‡ªå®šä¹‰åŠ¨ä½œï¼Œå¿«æ·é”®æŒ‰è‡ªå·±çš„å–œå¥½è®¾ç½®ï¼Œå‚æ•°é¡¹å¡« `difftool -y -t sourcetree $SHA HEAD` å³å¯ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/7-3.jpg?raw=true)

ä»¥ä¸Šé…ç½®å®Œæˆä¹‹åå°±å¤§åŠŸå‘Šæˆäº†ï¼Œä½¿ç”¨æ–¹å¼å°±æ˜¯åœ¨ `SourceTree` ä¸­é€‰ä¸­ä¸€ä¸ªé `HEAD` çš„ `commit`ï¼Œç„¶åæŒ‰ä¸‹å¿«æ·é”®ï¼Œå°±ä¼šåœ¨ `Kaleidoscope` æ‰“å¼€æ‰€æœ‰æ”¹åŠ¨è¿‡çš„æ–‡ä»¶ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/7-4.jpg?raw=true)

Swift 4.0 ä¸­ Dictionary ç¼–ç æˆç±»æ•°ç»„ç»“æ„çš„å­—ç¬¦ä¸²
----

åœ¨Swift 4.0ä¸­ï¼Œä½¿ç”¨`Codable`æ¥ç¼–ç ä¸€ä¸ª`Dictionary`æ—¶ï¼ŒæŸäº›æƒ…å†µä¸‹å¾—åˆ°çš„å¯èƒ½å¹¶ä¸æ˜¯ç±»ä¼¼äºå­—å…¸/å¯¹è±¡ç»“æ„çš„å­—ç¬¦ä¸²ï¼Œè€Œå¯èƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„ç»“æ„çš„å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```swift
let dict: [Float : String] = [
    18.0: "ff0000",
    20.0: "00ff00",
    21.0: "0000ff"
]

let encoder = JSONEncoder()
encoder.outputFormatting = [.prettyPrinted, .sortedKeys]
let encoded = try! encoder.encode(dict)
let jsonText = String(decoding: encoded, as: UTF8.self)
print(jsonText)

//[
//  21,
//  "0000ff",
//  18,
//  "ff0000",
//  20,
//  "00ff00"
//]
```

è¿™é‡Œçš„`dict`ä»¥`Float`ç±»å‹ä¸º`key`ï¼Œç»“æœæ˜¯è¾“å‡ºä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å­—ç¬¦ä¸²ã€‚æŸ¥çœ‹æºç ä¸­`Dictionary`å¯¹`Encodable`åè®®çš„æ‰©å±•å®ç°ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```swift
extension Dictionary : Encodable /* where Key : Encodable, Value : Encodable */ {
    public func encode(to encoder: Encoder) throws {
        assertTypeIsEncodable(Key.self, in: type(of: self))
        assertTypeIsEncodable(Value.self, in: type(of: self))

        if Key.self == String.self {
            // Since the keys are already Strings, we can use them as keys directly.
            var container = encoder.container(keyedBy: _DictionaryCodingKey.self)
            for (key, value) in self {
                let codingKey = _DictionaryCodingKey(stringValue: key as! String)!
                try (value as! Encodable).__encode(to: &container, forKey: codingKey)
            }
        } else if Key.self == Int.self {
            // Since the keys are already Ints, we can use them as keys directly.
            var container = encoder.container(keyedBy: _DictionaryCodingKey.self)
            for (key, value) in self {
                let codingKey = _DictionaryCodingKey(intValue: key as! Int)!
                try (value as! Encodable).__encode(to: &container, forKey: codingKey)
            }
        } else {
            // Keys are Encodable but not Strings or Ints, so we cannot arbitrarily convert to keys.
            // We can encode as an array of alternating key-value pairs, though.
            var container = encoder.unkeyedContainer()
            for (key, value) in self {
                try (key as! Encodable).__encode(to: &container)
                try (value as! Encodable).__encode(to: &container)
            }
        }
    }
}
```

å¯ä»¥çœ‹åˆ°å½“ `key` çš„ç±»å‹ä¸º `String` å’Œ `Int` æ—¶ï¼Œä½¿ç”¨ `_DictionaryCodingKey` æ¥ç¼–ç  `key`ï¼Œè¿›è€Œç¼–ç  `key-value` å¯¹ï¼Œæœ€åä»¥ç±»ä¼¼å­—å…¸çš„ç»“æ„è¾“å‡º(ä¾èµ–äº `keyed container` )ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ `Codable` ç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤ä¸ªç±»å‹æ˜¯æœ‰æ•ˆçš„å¯ç¼–ç  `key` ç±»å‹ï¼›è€Œå…¶å®ƒç±»å‹åˆ™ä¸æ˜¯ï¼Œç”±äº `Dictionary` æ— æ³•å‘Šè¯‰å…¶å®ƒç±»å‹å¦‚ä½•ç¼–ç è‡ªèº«ï¼Œæ‰€ä»¥å°†è¿™äº›å€¼ `key` å­˜å‚¨åœ¨ä¸€ä¸ª `unkeyed container` ä¸­ï¼Œæœ€ç»ˆå¤„ç†æˆä¸€ä¸ªæ•°ç»„ã€‚

å‚è€ƒï¼š

1. [UnkeyedEncodingContainer](https://developer.apple.com/documentation/swift/unkeyedencodingcontainer)
2. [Why Dictionary sometimes encodes itself as an array](https://oleb.net/blog/2017/12/dictionary-codable-array/)

CoreAnimation ä¸ pop çš„å¯¹æ¯”
----

æœ€è¿‘åœ¨ `Medium` ä¸Šçœ‹åˆ°ä¸€ç¯‡ã€ŠShould you use POP?ã€‹çš„æ–‡ç« ï¼Œæ–‡ç« ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥å¯¹æ¯”äº† `pop` å’Œ `Core Animation`ã€‚

* `Core Animation` å·¥ä½œåŸç†ï¼šæ¯æ¬¡æ·»åŠ åŠ¨ç”»æ—¶ `QuartzCore` ä¼šæ‰“åŒ…å…¶å‚æ•°ï¼Œç„¶åé€šè¿‡è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªåä¸º `backboardd` çš„åå°è¿›ç¨‹ã€‚ç„¶åè¯¥è¿›ç¨‹é€šè¿‡ `OpenGL` æ¸²æŸ“å’Œå¤„ç† `layer` çš„å±‚çº§ä»¥åŠ `layer` ä¸Šçš„åŠ¨ç”»ã€‚æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¯¥è¿›ç¨‹å®Œå…¨ç‹¬ç«‹äºä½ çš„åº”ç”¨ï¼Œåº”ç”¨åªä¼šæ‹¿åˆ°åŠ¨ç”»å¼€å§‹å’Œç»“æŸçš„å›è°ƒï¼ˆ`CAAnimationDelegate`ï¼‰ï¼Œä¸è´Ÿè´£åŠ¨ç”»çš„æ¸²æŸ“ï¼ˆæ˜¾å¼åŠ¨ç”»é™¤å¤–ï¼‰ã€‚ä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹å’Œ `CoreAnimation` ä¸ä¼šäº’ç›¸å½±å“ï¼Œä¹Ÿå°±æ˜¯å³ä½¿ä¸»çº¿ç¨‹é˜»å¡äº†ï¼Œ`CoreAnimation` ä¾æ—§åœ¨æ‰§è¡Œã€‚

* `pop` çš„å·¥ä½œåŸç†ï¼šä½¿ç”¨ `CADisplayLink` æ¥å¼€å¯ä¸€ä¸ª `fps=60` çš„æ¸²æŸ“å·¥ä½œã€‚æ¯å½“ `CADisplayLink` å›è°ƒè§¦å‘æ—¶ï¼Œæ›´æ–°ä¸€ä¸‹åŠ¨ç”»çš„è¿›åº¦ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸€å¸§å‘ç”Ÿæ”¹å˜æ—¶éƒ½éœ€è¦é€šçŸ¥ `backboardd` æ¥æ¸²æŸ“ï¼Œå› ä¸ºå®ƒå¯¹äº `layer` çš„å˜åŒ–å¹¶ä¸çŸ¥æƒ…ã€‚

* ç”±äº `pop` å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸Šå¤„ç†åŠ¨ç”»ï¼Œæ‰€ä»¥ `pop` åŠ¨ç”»å¾ˆæœ‰å¯èƒ½å‘ç”Ÿå¡é¡¿ã€‚ä½œè€…å†™äº†ä¸€ä¸ª `Demo` æ¥æ¼”ç¤ºå¯¹åº”æ•ˆæœï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼Œå·¦è¾¹ä¸º `Core Animation` çš„æ–¹å¼ï¼Œå³è¾¹ä¸º `pop` çš„æ–¹å¼ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/9-1.gif?raw=true)

* ä½œè€…å¯¹æ¯”äº† `Core Animation` å’Œ `pop` çš„æ€§èƒ½ã€‚åŒæ ·åŠ¨ç”»æ•ˆæœæƒ…å†µä¸‹(è¿è¡Œ10s)ï¼Œä½¿ç”¨ `Time Profiler` çœ‹ `backboardd` (`CoreAnimation`) å’Œåº”ç”¨(`pop`) `CPU` æ¶ˆè€—ï¼Œ`iPhone4 iOS7.1.2` å’Œ `iPhone6 iOS8.1.1` çš„å¯¹æ¯”ç»“æœä¸‹å›¾æ‰€ç¤ºï¼ˆå·¦è¾¹ `iPhone4`ï¼Œå³è¾¹ `iPhone6`ï¼‰ã€‚å¯ä»¥çœ‹å‡ºä¸¤è€… `backboardd` è¿›ç¨‹çš„ `CPU` è€—æ—¶å·®åˆ«åœ¨ `100ms` å·¦å³ï¼Œä½†æ˜¯åº”ç”¨çš„ `CPU` è€—æ—¶å·®è·ååˆ†æ˜æ˜¾ï¼Œ`Core Animation` åº”ç”¨ `CPU` è€—æ—¶æ¥è¿‘äº0ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/9-2.jpg?raw=true)

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/9-3.jpg?raw=true)

* ç»“è®ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚`Core Animation` ä¼˜ç‚¹ä¸ºï¼šâ‘ å•ç‹¬è¿›ç¨‹è¿è¡Œ â‘¡ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ç¼ºç‚¹ä¸ºï¼šâ‘ å¤æ‚åŠ¨ç”»æ•ˆæœè¦å†™å†—é•¿çš„ä»£ç  â‘¡æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”»æ¯”è¾ƒå¤æ‚ã€‚ `pop` çš„ä¼˜ç‚¹ä¸ºï¼šâ‘ ä¸°å¯Œçš„ API â‘¡å†…ç½®å¾ˆå¤šçš„åŠ¨ç”» ç¼ºç‚¹ä¸ºï¼šâ‘ åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œ â‘¡åŠ¨ç”»è¿‡ç¨‹å¯èƒ½å¡é¡¿ â‘¢æ¶ˆè€—æ›´é«˜çš„ `CPU`

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/9-4.jpg?raw=true)



å®ä¸­çš„ ## çš„å«ä¹‰
----
**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

åœ¨å®çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šé‡åˆ°è¿‡ `##`ï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä¸­ `##` ä½¿ç”¨åœºæ™¯ï¼š

å¾®ä¿¡ WCDB ä¸­çš„å®å®šä¹‰ï¼š
`#define __WCDB_BINDING(className) _s_##className##_binding`

å”±å§ KTVHTTPCache å®šä¹‰ä¸åŒç±»ä¸­æ˜¯å¦å¯ä»¥æ‰“å°çš„ä¾‹å­ï¼š
`#define KTVHCLogEnableValueConsoleLog(target)       KTVHCLog_##target##_ConsoleLogEnable`

é‚£ `##` æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ
`##` åœ¨å®ä¸­çš„ä½œç”¨å°±æ˜¯å…ˆåˆ†éš”ï¼Œç„¶åè¿›è¡Œå¼ºåˆ¶è¿æ¥ã€‚æˆ‘ä»¬å¯èƒ½ä¼šå®šä¹‰ä¸åŒçš„å‡½æ•°åæˆ–å˜é‡æ—¶å°±å¯ä»¥ä½¿ç”¨è¿™æ ·çš„å®å®šä¹‰ã€‚

é‚£ `##` æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ

1. `__WCDB_BINDING(className)` ï¼Œé¦–å…ˆ `_s_##className##_binding` ä¼šæ‹†åˆ†æˆ `_s`,`className `,`_binding `ã€‚__WCDB_BINDING(ViewController) å°†ä¼šè¢«æ›¿æ¢æˆ `_s_ViewController_binding`ï¼›

2. `KTVHCLogEnableValueConsoleLog(target)`ï¼Œé¦–å…ˆ `KTVHCLog_##target##_ConsoleLogEnable` ä¼šè¢«æ‹†åˆ†ä¸º `KTVHCLog_`, `target ` å’Œ `_ConsoleLogEnable`ã€‚KTVHCLogEnableValueConsoleLog(Lefex) ä¼šè¢«æ›¿æ¢æˆ `KTVHCLog_ Lefex_ConsoleLogEnable`ï¼›

3.å½“ä½¿ç”¨ KTVHCLogEnable(HTTPServer, YES) ï¼Œå°†ä¼šå®šä¹‰ä¸€ä¸ªåä¸º `KTVHCLog_ HTTPServer_ConsoleLogEnable` é™æ€å¸¸é‡ï¼Œåˆå§‹å€¼ä¸º YESã€‚

```c
#define KTVHCLogEnable(target, console_log_enable)               \
static BOOL const KTVHCLog_##target##_ConsoleLogEnable = console_log_enable;        \
```

æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ View åå­—åˆ›å»ºä¸åŒçš„ Viewï¼š

```objc
#define Name(target) weibo_##target##_name
#define View(target) view##target##Label

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    NSString * Name(lefex) = @"Lefe_x";
    // æ‰“å°ï¼šYou weibo name is: Lefe_x
    NSLog(@"You weibo name is: %@", weibo_lefex_name);
    
    UILabel *View(1) = [UILabel new];
    view1Label.backgroundColor = [UIColor redColor];
    
    UIView *View(2) = [UIView new];
    view2Label.backgroundColor = [UIColor yellowColor];
}
```


iOSå¿«é€Ÿè§£æå´©æºƒæ—¥å¿—
----
**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

å¹³æ—¶æˆ‘ä»¬æ‹¿åˆ°ä¸€ä»½å´©æºƒæ—¥å¿—ï¼Œéœ€è¦è§£æï¼Œä¸€èˆ¬æ“ä½œæ˜¯å–åˆ°å¯¹åº”çš„ dSYM å’Œå¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åæ‹¿åˆ°ç›¸åº”çš„å´©æºƒæ—¥å¿— uuid ã€äºŒè¿›åˆ¶çš„ uuidã€dSYM çš„ uuid é€šè¿‡å‘½ä»¤è¡Œæ¥è§£æã€‚è¿™äº›æ“ä½œæ„Ÿè§‰æ¯”è¾ƒè€—æ—¶ã€‚ä¸‹é¢ä»‹ç»å‡ ç§æƒ…å†µä¸‹çš„å¿«é€Ÿè§£æçš„æ–¹æ³•ï¼š

- 1ã€è‡ªå·±è®¾å¤‡ä¸Š Xcode ç¼–è¯‘çš„åŒ…å‘ç”Ÿé—ªé€€ï¼šè¿ä¸Šæ‰‹æœºæ‰“å¼€ Xcodeï¼Œcmd+shift+2 å‘¼å‡º Device çš„ Windowï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œç„¶åç‚¹å‡» View Device Logsï¼Œç„¶åé€‰ä¸­å¯¹åº”æ—¶é—´æ®µè‡ªå·± app çš„å´©æºƒæ—¥å¿—ã€‚å¦‚æœæ­¤æ—¶å¯¹åº”çš„è°ƒç”¨æ ˆè¿˜æ²¡æœ‰ç¬¦å·åŒ–ï¼Œå¯ä»¥é€‰ä¸­æ—¥å¿—åå³é”®å¦‚å›¾2æ‰€ç¤º Re-Symbolicate Log å³å¯ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/10-1.jpg?raw=true)

- 2ã€å¦‚æœæ˜¯æ‰“åŒ…æœåŠ¡å™¨æˆ–è€… Appstore çš„åŒ…å‘ç”Ÿé—ªé€€ï¼šæ‹·è´å¯¹åº”çš„åŒ…å’Œ dSYM åˆ°ä»»æ„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ³¨æ„å°† dSYM è§£å‹ä»¥åŠ .ipa é‡Œé¢çš„ .app å–å‡ºã€‚ç„¶åæŒ‰ç…§æƒ…å†µ1çš„æ–¹å¼å¤„ç†å³å¯ï¼ŒXcode ä¼šè‡ªåŠ¨ç´¢å¼•äºŒè¿›åˆ¶åŠ dSYMã€‚

- 3ã€å¦‚æœæ‹¿åˆ°åˆ«çš„è®¾å¤‡å¯¼å‡ºçš„æœªç¬¦å·åŒ–çš„å´©æºƒæ—¥å¿—ï¼Œå¯ä»¥å°†æ—¥å¿—æ‹–è‡³å›¾2æ‰€ç¤ºçš„åˆ—è¡¨ä¸­ï¼Œæ³¨æ„æ­¤æ—¶ä¸Šé¢ tab è®°å¾—é€‰ All Logs è€Œä¸æ˜¯ This Deviceï¼Œç„¶åå‚è€ƒæƒ…å†µ2ï¼Œæ‰¾åˆ°å´©æºƒæ—¥å¿—å¯¹åº”çš„äºŒè¿›åˆ¶åŒ…å’Œ dSYM æ–‡ä»¶ï¼ŒæŒ‰ç…§æƒ…å†µ2å¤„ç†å³å¯ã€‚å¯èƒ½ä¼šé‡åˆ°ç³»ç»Ÿåº“çš„ä¸€äº›æ–¹æ³•æ— æ³•ç¬¦å·åŒ–çš„é—®é¢˜ï¼Œåªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡è¿ä¸Šç”µè„‘ï¼Œè®© Xcode è¯»å–ä¸€éè¯¥è®¾å¤‡(åŒæœºå‹å’Œç³»ç»Ÿç‰ˆæœ¬çš„ä¹Ÿå¯ä»¥)çš„ç¬¦å·è¡¨ï¼Œç„¶åå† Re-Symbolicate ä¸€éå°±è¡Œã€‚

- 4ã€é‡åˆ°çº¿ä¸Šç”¨æˆ·å´©æºƒï¼Œæ— æ³•æ‹¿åˆ°å®Œæ•´å´©æºƒæ—¥å¿—ï¼Œå¯ä»¥è®©ç”¨æˆ·åˆ°ã€è®¾ç½®->åˆ†æ->åˆ†ææ•°æ®ã€‘é‡Œé¢æ‰¾åˆ°å¯¹åº”æ—¶é—´ç‚¹çš„å´©æºƒæ—¥å¿—ï¼Œç„¶åæˆªå›¾ï¼Œæ ¹æ®ä¸€ä¸ªå¼€æºå·¥å…· [dSYMTools](https://github.com/answer-huang/dSYMTools)ï¼ŒæŠŠå´©æºƒæ ˆçš„å…³é”®åœ°å€è¾“å…¥åˆ°æ–‡æœ¬æ¡†ä¸­å³å¯è§£æå‡ºå´©æºƒçš„é‚£ä¸ªæ–¹æ³•ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒ [ReadMe](https://github.com/answer-huang/dSYMTools)ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/12/10-2.jpg?raw=true)

