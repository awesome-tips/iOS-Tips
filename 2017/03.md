# 2017.03

åˆ¤æ–­å­—èŠ‚åº
----------

`Swift`ä¸­çš„æ•´å‹ç±»å‹æä¾›äº†ä¸¤ä¸ªå±æ€§åˆ†åˆ«è·å–å…¶å¤§ç«¯å­—èŠ‚åºè¡¨ç¤º(`bigEndian`)å’Œå°ç«¯å­—èŠ‚åºè¡¨ç¤º(`littleEndian`)ã€‚å¦‚æœæƒ³åœ¨Swiftåˆ¤æ–­å½“å‰å¹³å°çš„å­—èŠ‚åºæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Œå¯ä»¥ç®€å•çš„ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š

```swift
let isLittleEndian = 1 == 1.littleEndian
```

string view 
----------

`Swift`ä¸­çš„`String`æœ¬èº«ä¸æ˜¯ä¸€ä¸ªé›†åˆï¼Œä¸è¿‡å®ƒæä¾›äº†ä¸€äº›å±æ€§æ¥å°†å…¶å†…å®¹è¡¨ç¤ºä¸ºé›†åˆã€‚ä¸åŒçš„å±æ€§å¯ä»¥å°†å­—ç¬¦ä¸²å‘ˆç°ä¸ºä¸åŒçš„å¯è§†åŒ–åŠæ•°æ®è¡¨ç¤ºçš„è§†å›¾ï¼Œä¸»è¦æœ‰4ç§ç±»å‹ï¼š

1. `Character View`(`characters`å±æ€§ï¼Œç±»å‹ä¸º`String.Characterâ€‹View`)ï¼šæ‰©å±•å­—ç¬¦é›†ç¾¤çš„é›†åˆï¼Œç±»ä¼¼äºè‡ªç„¶è¯­è¨€å­—ç¬¦ã€‚ä¸»è¦æ˜¯ä»¥`Unicode`å­—ç¬¦æ¥è¡¨ç¤ºï¼›
2. `Unicode Scalar View`(`unicode Scalars`ï¼Œç±»å‹ä¸º`String.Unicodeâ€‹Scalarâ€‹View`)ï¼š`Unicode`æ ‡é¢˜å€¼çš„é›†åˆï¼Œå³ä»¥`21-bit`ä½œä¸º`Unicode`çš„åŸºæœ¬å•å…ƒçš„å€¼ï¼›
3. `UTF-16 View`(`utf16`å±æ€§ï¼Œç±»å‹ä¸º`String.UTF16View`)ï¼š`UTF-16`å­—ç¬¦çš„é›†åˆï¼Œå³ä»¥`16-bit`ä½œä¸º`Unicode`çš„åŸºæœ¬å•å…ƒçš„å€¼ï¼›
4. `UTF-8 View`(`utf8`å±æ€§ï¼Œç±»å‹ä¸º`String.UTF8View`)ï¼š`UTF-8`å­—ç¬¦çš„é›†åˆï¼Œå³ä»¥`8-bit`ä½œä¸º`Unicode`çš„åŸºæœ¬å•å…ƒçš„å€¼ï¼›å¦‚æœ`Swift`è¦å’Œ`C API`äº¤äº’ï¼Œåˆ™`String`ä»¥è¿™ç§æ ¼å¼ä¼ é€’ç»™Cå‡½æ•°ï¼›

å®˜æ–¹æ–‡æ¡£ç»™äº†ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¿™å‡ ç§è¡¨ç¤ºæ–¹å¼çš„åŒºåˆ«ã€‚

```swift
let cafe = "Cafe\u{301} du ğŸŒ"

print(cafe.unicodeScalars.count)
// Prints "10"
print(Array(cafe.unicodeScalars))
// Prints "["C", "a", "f", "e", "\u{0301}", " ", "d", "u", " ", "\u{0001F30D}"]"
print(cafe.unicodeScalars.map { $0.value })
// Prints "[67, 97, 102, 101, 769, 32, 100, 117, 32, 127757]"

print(cafe.utf16.count)
// Prints "11"
print(Array(cafe.utf16))
// Prints "[67, 97, 102, 101, 769, 32, 100, 117, 32, 55356, 57101]"

print(cafe.utf8.count)
// Prints "14"
print(Array(cafe.utf8))
// Prints "[67, 97, 102, 101, 204, 129, 32, 100, 117, 32, 240, 159, 140, 141]"
```

å‚è€ƒ

1. [String](https://developer.apple.com/reference/swift/string)

iOS 10.3ç§»é™¤Keychainä¸­çš„æ•°æ®
----------

ä»`iOS 10.3`(ç›®å‰è¿˜æ˜¯betaç‰ˆæœ¬)å¼€å§‹ï¼Œä¿å­˜åœ¨`keychain`ä¸­çš„Appç›¸å…³çš„æ•°æ®ï¼Œä¼šéšç€åº”ç”¨çš„åˆ é™¤è€Œè¢«æ¸…é™¤ï¼Œé‡æ–°å®‰è£…Appåå°†æ— æ³•å†ä»`keychain`ä¸­è·å–åº”ç”¨ç›¸å…³çš„æ•°æ®ã€‚è€Œ10.3ä¹‹å‰åˆ é™¤Appå¹¶ä¸ä¼šæ¸…ç†`keychain`ä¸­çš„å¯¹åº”æ•°æ®ã€‚

å¦‚æœå¸Œæœ›Appåœ¨é‡æ–°å®‰è£…åï¼Œä»ç„¶å¯ä»¥è·å–åˆ°ä¹‹å‰çš„ä¸€äº›æ•°æ®ï¼Œåˆ™ä¾èµ–äº`keychain`çš„æ–¹æ¡ˆå°†å˜å¾—ä¸å¯é ã€‚

ä¸è¿‡ï¼Œå¦‚æœæ•°æ®æ˜¯åœ¨å¤šä¸ªAppé—´å…±äº«ï¼Œåˆ™åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„Appéƒ½è¢«åˆ é™¤åï¼Œæ‰ä¼šåˆ é™¤`keychain`ä¸­çš„è¿™äº›å…±äº«æ•°æ®ã€‚

è‡³äºå…·ä½“åŸç”±ï¼Œå¯ä»¥å‚è€ƒ[iOS 10.3 Beta 2 autodeletes keychain items after application uninstall?](https://forums.developer.apple.com/thread/72271)ã€‚

> This is an intentional change in iOS 10.3 to protect user privacy. Information that can identify a user should not be left on the device after the app that created it has been removed.
 
> It has never been a part of the API contract that keychain items created by an app would survive when the app is removed. This has always been an implementation detail.
 
> If a keychain item is shared with other apps, it won't be deleted until those other apps have been deleted as well.
 
> There is documentation in the works about this change that should address questions raised in this thread.

UIWebViewæ‰“å¼€PDFæ–‡ä»¶
----------

`UIWebView`å¯ä»¥ç›´æ¥æ‰“å¼€PDFæ–‡ä»¶ï¼Œä»£ç å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
@IBOutlet weak var webView: UIWebView!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        let filename = Bundle.main.path(forResource: "test", ofType: "pdf")
        let url = URL(fileURLWithPath: filename!)
        
        let request = URLRequest(url: url)
        self.webView.scalesPageToFit = true
        self.webView.loadRequest(request)
    }
```

æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/03/4-1.png?raw=true)

åŠ è½½çš„PDFæ–‡ä»¶æ˜¯æ”¾ç½®åœ¨ä¸€ä¸ª`UIWebPDFView`è§†å›¾ä¸­ï¼Œ`UIWebPDFView`åº”è¯¥æ˜¯ä¸€ä¸ªç§æœ‰ç±»ï¼Œå¯ä»¥åœ¨ [UIWebPDFView.h](https://github.com/nst/iOS-Runtime-Headers/blob/master/Frameworks/UIKit.framework/UIWebPDFView.h)æŸ¥çœ‹å…¶å£°æ˜ã€‚

iOSæ¨¡æ‹Ÿå™¨çš„Debugèœå•
----------

iOSæ¨¡æ‹Ÿå™¨çš„`Debug`èœå•ä¸­æä¾›äº†å‡ ä¸ªèœå•é¡¹æ¥æ£€æµ‹å½±å“å¸§ç‡çš„ä¸€äº›å› ç´ ï¼š

1. `Color Blended Layers`: é«˜äº®æ˜¾ç¤ºæœ‰æ··åˆæ“ä½œçš„åŒºåŸŸï¼›
2. `Color Copied Images`: é«˜äº®æ˜¾ç¤ºè¢«æ‹·è´çš„å›¾ç‰‡ã€‚æ‹·è´å›¾ç‰‡æ„å‘³ç€`Core Animation`éœ€è¦æ‹·è´ä¸€ä»½å›¾ç‰‡å¹¶å‘é€ç»™`render server`ï¼Œè¿™å¯¹å†…å­˜å’ŒCPUçš„ä½¿ç”¨éƒ½æ˜¯æ˜‚è´µçš„ï¼›
3. `Color Misaligned Images`: é«˜äº®æ˜¾ç¤ºç¼©æ”¾æˆ–æ‹‰ä¼¸è¿‡çš„å›¾ç‰‡ï¼Œæˆ–è€…æ²¡æœ‰æ­£ç¡®å¯¹é½å¯¹åˆ°åƒç´ è¾¹ç•Œçš„å›¾ç‰‡ï¼›
4. `Color Offscreen-Rendered`: é«˜äº®æ˜¾ç¤ºç¦»å±æ¸²æŸ“çš„å±‚å¯¹è±¡ã€‚

å½“ç„¶è¿™å‡ ä¸ªé€‰é¡¹åœ¨`Instrument`çš„`Core Animation`å·¥å…·ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ã€‚

å‚è€ƒ

iOS Core Animation Advanced Techniques

Swift auto diagram
----------

`OmniGraffle`æ— æ³•ç»˜åˆ¶`Swift`çš„ç±»å›¾ï¼Œåªèƒ½å†æ‰¾ä¸ªæ›¿ä»£å·¥å…·ï¼š`swift auto diagram`ã€‚è¿™æ˜¯ä¸€ä¸ªrubyå†™çš„[å¼€æºåº“](https://github.com/yoshimkd/swift-auto-diagram)ã€‚

ä¸‹è½½æºç åï¼Œå¯ä»¥åœ¨å·¥å…·æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼š

```ruby
ruby generateClassDiagram.rb ~/workspace/my-swift-project
```

ç„¶åä¼šç”Ÿæˆä¸€ä¸ªé™æ€htmlé¡µé¢ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2017/03/6-1.png?raw=true)

å¯ä»¥çœ‹åˆ°å…¶ä»¥ä¸åŒé¢œè‰²æ ‡å‡ºäº†`protocol`, `class`, `struct`, `extension`ç­‰ç±»å‹åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚åœ¨è¿™ä¸ªé¡µé¢é‡Œé¢å¯ä»¥è‡ªç”±åœ°æ‹–åŠ¨ç±»å‹æ¡†ã€‚å—¯ï¼Œä¸è¿‡ï¼Œè°ˆä¸ä¸Šç¾è§‚å•Š~~~

å‚è€ƒ

[Swift Class Diagrams and more](https://martinmitrevski.com/2016/10/12/swift-class-diagrams-and-more/)

Core Animationä¸­CPUæ“ä½œçš„å½±å“å› ç´ 
----------

`Core Animation`ä¸­CPUçš„æ“ä½œåœ¨åŠ¨ç”»å¼€å§‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥é€šå¸¸ä¸ä¼šå½±å“åˆ°åŠ¨ç”»çš„å¸§ç‡ï¼Œä½†æ˜¯ä¼šå½±å“åˆ°åŠ¨ç”»çš„å¼€å§‹ã€‚ä»¥ä¸‹ä¸€äº›æ“ä½œä¼šå»¶è¿ŸåŠ¨ç”»çš„å¼€å§‹æ—¶é—´ï¼š

1. å¸ƒå±€è®¡ç®—ï¼šè¿™å¯ä»¥ç†è§£ï¼Œè§†å›¾è¶Šå¤æ‚ï¼Œéœ€è¦çš„è®¡ç®—é‡è¶Šå¤§ã€‚ç‰¹åˆ«æ³¨æ„`auto layout`æ˜¯ä¸€ç§CPUå¯†é›†å‹æ“ä½œï¼Œæ¯”ä¼ ç»Ÿçš„`autoresizing`æ›´è€—CPUï¼›
2. å»¶è¿ŸåŠ è½½è§†å›¾æœºåˆ¶ï¼šè¿™ä¸ªæœºåˆ¶å¸¦æœ‰ä¸¤é¢æ€§ï¼Œä¼˜ç‚¹æ˜¯ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œå¯åŠ¨æ—¶é—´ï¼›ç¼ºç‚¹çš„æ¶‰åŠåˆ°IOæ“ä½œï¼›
3. `Core Graphics`ç»˜åˆ¶ï¼šè‡ªå®šä¹‰çš„`-drawRect:`æˆ–`-drawLayer:inContext:`ä¼šå¼•å…¥æ˜¾è‘—çš„æ€§èƒ½å¼€é”€ï¼›å› ä¸º`Core Animation`ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªä¸è§†å›¾ç­‰å¤§å°çš„`backing image`ç”¨æ¥ç»˜åˆ¶ï¼Œç„¶åå†é€šè¿‡`IPC`å°†è¿™ä¸ªå›¾ç‰‡æ•°æ®å‘é€ç»™`render server`ï¼›
4. å›¾ç‰‡è§£å‹ã€‚

å‚è€ƒ

iOS Core Animation Advanced Techniques

