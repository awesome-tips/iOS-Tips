# 2018.01

ä¸ºä»€ä¹ˆéŸ³é¢‘æ’­æ”¾å™¨çªç„¶æ²¡å£°éŸ³äº†å‘¢ï¼Ÿ
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)


åšéŸ³é¢‘çš„åŒå­¦å¯èƒ½éƒ½ä¼šé‡åˆ°æ’­æ”¾çš„éŸ³é¢‘çªç„¶æ²¡å£°éŸ³çš„æƒ…å†µï¼Œé‡åˆ°è¿™ç§æƒ…å†µåï¼Œä¸€èˆ¬æ§åˆ¶å°ä¼šæŠ›å‡ºä¸‹é¢çš„é”™è¯¯ï¼š

```objc
[AVAudioSession setActive:withOptions:error:]: Deactivating an audio session that has running I/O. All I/O should be stopped or paused prior to deactivating the audio session.`
```

é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼Œä¼šå¯¼è‡´éŸ³é¢‘ä¸èƒ½æ­£å¸¸æ’­æ”¾çš„æƒ…å†µã€‚å‡ºç°è¿™ç§æƒ…å†µçš„ä¸»è¦åŸå› å½“ä½ è®¾ç½®

```objc
[[AVAudioSession sharedInstance] setActive:NO withOptions:AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation error:nil];
```

æ—¶è¿˜æœ‰æŸäº›æ“ä½œå ç”¨äº† `AVAudioSession` æƒé™ï¼Œå¿…é¡»æš‚åœæˆ–åœæ­¢å¯¹ `AVAudioSession` çš„ä½¿ç”¨ã€‚æ¯”å¦‚ä½¿ç”¨ `AVAudioPlayer` æ’­æ”¾æŸä¸€éŸ³é¢‘æ—¶ï¼Œæ­¤æ—¶éŸ³é¢‘æ­£åœ¨æ’­æ”¾ï¼Œç›´æ¥è®¾ç½® `AVAudioSession` çš„ `active` ä¸º `NO`ï¼Œå°±ä¼šæŠ¥ä¸Šé¢æåˆ°çš„é”™è¯¯ã€‚è€Œæ­£ç¡®çš„åšæ³•æ˜¯å…ˆæš‚åœæ’­æ”¾ï¼Œå†è®¾ç½® `AVAudioSession` çš„ `active` ä¸º `NO`ã€‚å…¶æ­£ç¡®çš„åšæ³•åƒä¸‹é¢ä»£ç æ‰€ç¤ºï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå½“é‡åˆ°è®¾ç½®å¤±è´¥åå¯ä»¥ç¬¬ä¸€æ—¶é—´çŸ¥é“å‡ºé”™çš„æ—¶é—´ç‚¹ã€‚

```objc
NSError *error;
BOOL isSuccess = [[AVAudioSession sharedInstance] setActive:active withOptions:AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation error:&error];
if (isSuccess) {
   NSLog(@"æ­å–œä½ æˆåŠŸè®¾ç½®");
} else {
   NSLog(@"è®¾ç½®å¤±è´¥");
}
```

å½“ç„¶å¦‚æœåº”ç”¨ä¸­æœ‰å¤šä¸ªåœ°æ–¹ä½¿ç”¨ `AVAudioSession`ï¼Œå»ºè®®é¡¹ç›®ä¸­ç»Ÿä¸€å¤„ç† `AVAudioSession` çš„ `active`ï¼Œè¿™æ ·é¿å…å‡ºç°é”™è¯¯ï¼Œä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œè°ƒè¯•èµ·æ¥å°±éå¸¸è´¹åŠ²ã€‚

iOS ä¸­éŸ³é‡æ§åˆ¶è§£æƒ‘
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)


iOS ä¸­éŸ³é‡ä¸­å…¶å®ä¹Ÿæœ‰å¥½å¤šå°çªé—¨ï¼Œè¿™ä¸ªå°é›†å¸®ä½ è§£æƒ‘ã€‚iOS ä¸­ä¸»è¦æœ‰2ä¸ªåœ°æ–¹å¯ä»¥æ§åˆ¶éŸ³é‡ï¼Œä¸€ä¸ªæ˜¯ç³»ç»ŸéŸ³é‡ï¼Œç”¨æˆ·ä¸»åŠ¨æŒ‰éŸ³é‡é”®ï¼Œè°ƒæ•´éŸ³é‡ï¼Œè¿™ç§æ–¹å¼ä¼šæ˜¾ç¤ºç³»ç»ŸéŸ³é‡æç¤ºæ¡†ï¼›å¦ä¸€ä¸ªæ˜¯æ’­æ”¾å™¨çš„éŸ³é‡ï¼Œæ¯”å¦‚é€šè¿‡ `AVAudioPlayer` è°ƒæ•´éŸ³é‡ï¼Œè¿™ç§ä¸ä¼šæ˜¾ç¤ºç³»ç»Ÿæç¤ºéŸ³é‡æ¡†ã€‚

### å¦‚ä½•è°ƒèŠ‚éŸ³é‡æ—¶ä¸æ˜¾ç¤ºç³»ç»ŸéŸ³é‡æç¤ºæ¡†

ä¸»è¦åŸç†å°±æ˜¯è·å–ç³»ç»ŸéŸ³é‡ `View`ï¼Œå¹¶æŠŠå®ƒè®©ç”¨æˆ·ä¸å¯è§ã€‚ä½†æ³¨æ„ä¸€ç‚¹ï¼Œä½ ä¸èƒ½æŠŠ `MPVolumeView` çš„ `hidden` å±æ€§è®¾ç½®ä¸º `YES`ï¼Œè¿™æ ·å¯¼è‡´çš„ç»“æœæ˜¯ç”¨æˆ·è°ƒæ•´éŸ³é‡æ—¶ä»»ç„¶ä¼šæ˜¾ç¤ºç³»ç»ŸéŸ³é‡æç¤ºæ¡†ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚

```
_volumeView = [[MPVolumeView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
_volumeView.backgroundColor = [UIColor yellowColor];

// å¦‚æœè®¾ç½®äº† Hidden ä¸º YESï¼Œé‚£ä¹ˆä¿®æ”¹éŸ³é‡æ—¶ä¼šå¼¹å‡ºç³»ç»ŸéŸ³é‡æ¡†
_volumeView.hidden = NO;
_volumeView.alpha = 0.01;
for (UIView *view in [_volumeView subviews]){
if ([view.class.description isEqualToString:@"MPVolumeSlider"]){
    self.volumeSlider = (UISlider*)view;
    break;
   }
}
[self.view addSubview:_volumeView];
```

### è·å–ç³»ç»ŸéŸ³é‡

æ–¹æ³•ä¸€ï¼šé€šè¿‡ `self.volumeSlider` è·å–

å¦‚æœæƒ³è·å–ç³»ç»ŸéŸ³é‡ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸€ç§æ–¹å¼ï¼Œ`self.volumeSlider.value` æ¥è·å–ï¼Œä½†æ˜¯ä½ å‘ç°ç¬¬ä¸€æ¬¡ä¸º 0ï¼Œè¿™å¾ˆçº ç»“ï¼Œè¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯è·å–çš„ç³»ç»ŸéŸ³é‡ä¸å‡†ç¡®ã€‚è¿™æ˜¯å› ä¸ºåˆå§‹ `MPVolumeView` æ—¶ï¼Œ`volumeSlider.value` è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/2-1.jpg?raw=true)

å¯ä»¥å‘ç°ï¼ŒéŸ³é‡æ˜¯åæ¥é€šè¿‡ `[MPVolumeController updateVolumeValue]` æ¥æ›´æ–°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬ `self.volumeSlide` å€¼æ”¹å˜æ—¶çš„äº‹ä»¶ï¼Œè¾¾åˆ°è·å–ç³»ç»ŸéŸ³é‡çš„ç›®çš„ã€‚

```objc
[self.volumeSlider addTarget:self action:@selector(sliderValueDidChange:) forControlEvents:UIControlEventValueChanged];
```

æ–¹æ³•äºŒï¼šé€šè¿‡ `AVAudioSession` è·å–

```objc
[[AVAudioSession sharedInstance] outputVolume];
```

è¿™ç§æ–¹æ³•ç›´æ¥äº†å½“ã€‚

### è‡ªå®šä¹‰éŸ³é‡æ§ä»¶

å¦‚æœæƒ³è‡ªå®šä¹‰éŸ³é‡æ§ä»¶ï¼Œå¯ä»¥ç›‘å¬éŸ³é‡çš„å˜åŒ–ï¼Œå¹¶ä¸”é€šè¿‡ç¬¬ä¸€ç§æ–¹æ³•éšè—ç³»ç»ŸéŸ³é‡æç¤ºæ¡†ã€‚é€šè¿‡ç›‘å¬é€šçŸ¥ï¼Œè¾¾åˆ°ç›‘å¬éŸ³é‡å˜åŒ–çš„æ•ˆæœã€‚

### ç›‘å¬éŸ³é‡å˜åŒ–

ç›‘å¬éŸ³é‡å˜åŒ–ï¼Œé€šè¿‡ç›‘å¬é€šçŸ¥ 

```objc
AVSystemController_SystemVolumeDidChangeNotification

[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(volumeChanged:) name:@"AVSystemController_SystemVolumeDidChangeNotification" object:nil];
```

æœ€ç»ˆç»“æœ `AVSystemController_AudioVolumeNotificationParameter` è¡¨ç¤ºéŸ³é‡çš„å€¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ `"AVSystemController_AudioVolumeChangeReasonNotificationParameter" = ExplicitVolumeChange;` è¿™ä¸ªå€¼ï¼Œå®ƒä¼šç”±äºä¸åŒçš„åœºæ™¯ï¼Œæœ‰ä¸åŒçš„å€¼ã€‚`ExplicitVolumeChange` æ˜¯ç”¨æˆ·ç‚¹å‡»éŸ³é‡æŒ‰é’®ï¼Œ`CategoryChange` æ˜¯ç”¨æˆ·æŒ‰ `home` é”®è°ƒèµ· `Siri`ï¼Œ`RouteChange` è¿™ä¸ªæ—¶è·¯çº¿ä¿®æ”¹ï¼ˆä¸å¤ªæ¸…æ¥šï¼Œä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘çš„ï¼‰ã€‚

```objc
AVSystemController_SystemVolumeDidChangeNotification; object = <AVSystemController: 0x1c4001dc0>; userInfo = {
    "AVSystemController_AudioCategoryNotificationParameter" = "Audio/Video";
    "AVSystemController_AudioVolumeChangeReasonNotificationParameter" = ExplicitVolumeChange;
    "AVSystemController_AudioVolumeNotificationParameter" = "0.5625";
    "AVSystemController_UserVolumeAboveEUVolumeLimitNotificationParameter" = 0;
}}
```

### æ³¨æ„ç‚¹

å¦‚æœé€šè¿‡ä»£ç ä¿®æ”¹äº† `self.volumeSlide` çš„ `value`ï¼Œé‚£ä¹ˆä¼šæ˜¾ç¤ºå‡ºç³»ç»ŸéŸ³é‡æ¡†ï¼Œå¦‚æœä½ å‘ç°æŸä¸ªé¡µé¢çªç„¶è¹¦å‡ºä¸€ä¸ªç³»ç»ŸéŸ³é‡æ¡†ï¼ŒåŸå› å¤§å¤šæ•°æ˜¯ä½ ä¿®æ”¹äº†è¿™ä¸ªå€¼ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/2-2.jpg?raw=true)

åŠ¨æ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„icon
--------

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)


å¶ç„¶çœ‹åˆ° `Price Tag` æœ‰ä¸ªæ›¿æ¢åº”ç”¨å›¾æ ‡çš„åŠŸèƒ½ï¼Œå¦‚å›¾ï¼Œç ”ç©¶äº†ä¸€ä¸‹ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/3-1.png?raw=true)

è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨ `iOS 10.3` åæ–°å¢çš„ï¼Œä¸»è¦çš„ `API` å¦‚ä¸‹æ‰€ç¤ºï¼š

```objc
@interface UIApplication (UIAlternateApplicationIcons)
// If false, alternate icons are not supported for the current process.
@property (readonly, nonatomic) BOOL supportsAlternateIcons NS_EXTENSION_UNAVAILABLE("Extensions may not have alternate icons") API_AVAILABLE(ios(10.3), tvos(10.2));

// Pass `nil` to use the primary application icon. The completion handler will be invoked asynchronously on an arbitrary background queue; be sure to dispatch back to the main queue before doing any further UI work.
- (void)setAlternateIconName:(nullable NSString *)alternateIconName completionHandler:(nullable void (^)(NSError *_Nullable error))completionHandler NS_EXTENSION_UNAVAILABLE("Extensions may not have alternate icons") API_AVAILABLE(ios(10.3), tvos(10.2));

// If `nil`, the primary application icon is being used.
@property (nullable, readonly, nonatomic) NSString *alternateIconName NS_EXTENSION_UNAVAILABLE("Extensions may not have alternate icons") API_AVAILABLE(ios(10.3), tvos(10.2));
@end
```

åªè¯»å±æ€§ `supportsAlternateIcons` ç”¨äºåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å…è®¸ä¿®æ”¹ `App` å›¾æ ‡ï¼Œåªæœ‰åœ¨å…è®¸çš„æƒ…å†µä¸‹æ‰èƒ½ä¿®æ”¹ã€‚`-setAlternateIconName:completionHandler:` ç”¨äºæ‰§è¡Œä¿®æ”¹æ“ä½œï¼Œå¦‚æœ `iconName` è®¾ç½®ä¸º `nil`ï¼Œåˆ™æ¢å¤ä¸ºä¸»å›¾æ ‡ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```objc
- (IBAction)changeIcon:(UIButton *)sender {
    if ([[UIApplication sharedApplication] supportsAlternateIcons]) {
        
        NSString *iconName = nil;
        if (sender.tag == 1) {
            iconName = @"rocket";
        } else if (sender.tag == 2) {
            iconName = @"pin";
        }
        
        [[UIApplication sharedApplication] setAlternateIconName:iconName completionHandler:^(NSError * _Nullable error) {
            
        }];
    }
}
```

é™¤äº†è°ƒç”¨ `API` å¤–ï¼Œæœ€ä¸»è¦çš„è¿˜éœ€è¦åœ¨ `info.plist` ä¸­é…ç½® `CFBundleIcons` é¡¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¯åŒ…å« `CFBundlePrimaryIcon`ã€`CFBundleAlternateIcons`ã€`UINewsstandIcon` ä¸‰ä¸ªé”®ã€‚

`CFBundlePrimaryIcon` ä¸ºä¸»å›¾æ ‡ï¼Œå³ `Assets.xcassets` ä¸­ `AppIcon` çš„ä¿¡æ¯ï¼Œä¸€èˆ¬ç½®ç©ºã€‚`CFBundleAlternateIcons` å³ç”¨äºè®¾ç½®æ›¿æ¢å›¾æ ‡ï¼Œå…·ä½“çš„é…ç½®é¡¹æè¿°å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html) ï¼Œé€šå¸¸çš„é…ç½®å¦‚å›¾æ‰€ç¤ºã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/3-2.png?raw=true)

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ›¿æ¢å›¾æ ‡åº”è¯¥æ”¾åœ¨å·¥ç¨‹çš„æŸä¸ªç›®å½•ä¸‹ï¼Œè€Œä¸æ”¾åœ¨ `Assets.xcassets` ä¸­ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/3-3.png?raw=true)


iOS å…³äºéŸ³é¢‘æ’­æ”¾è°ƒç ”
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)


ç”±äºæœ€è¿‘åšéŸ³é¢‘æ–¹é¢çš„å·¥ä½œï¼Œå°±è°ƒç ”äº†ä¸€ä¸‹å…³äºéŸ³é¢‘æ’­æ”¾çš„ä¸€äº›çŸ¥è¯†ï¼Œä¸­é—´ä¹Ÿèµ°è¿‡ä¸å°‘å¼¯è·¯ï¼Œå¸Œæœ›è¿™ç¯‡å°é›†èƒ½å¯¹å…³æ³¨æˆ‘ä»¬çš„åŒå­¦ä¸€ç‚¹å¯ç¤ºï¼Œå°‘èµ°ä¸€äº›å¼¯è·¯ã€‚æœ€åæä¾›ä¸€ä»½æˆ‘çœ‹è¿‡çš„èµ„æ–™ã€‚è¿™é‡Œå…³äºéŸ³é¢‘æ’­æ”¾ç®€å•åšä¸€ä¸ªæ€»ç»“ã€‚iOS ä¸­éŸ³é¢‘æ’­æ”¾æœ‰ä»¥ä¸‹ 5 ç§æ–¹å¼ï¼ˆå¦‚æœä½ æœ‰æ›´å¤šçš„æ–¹å¼å‘Šè¯‰æˆ‘ï¼Œéå¸¸æ„Ÿæ¿€ï¼‰ï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å„ä¸åŒã€‚

[1] æ’­æ”¾å°äº 30s çš„éŸ³é¢‘ï¼š
`AudioServicesPlaySystemSound` å¯ä»¥æ’­æ”¾å°äºç­‰äº `30s` çš„éŸ³é¢‘ï¼Œä¸»è¦ç”¨äºæ’­æ”¾ä¸€äº›æç¤ºéŸ³ï¼Œä½ å¯ä»¥åˆ©ç”¨ `AudioServicesPlaySystemSoundWithCompletion` çš„å€¼æ’­æ”¾å®Œæˆçš„ `callback`ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ä½¿ç”¨ç³»ç»ŸéŸ³é‡ï¼Œä¸èƒ½ä¿®æ”¹æ’­æ”¾éŸ³é‡ï¼›
- ç«‹åˆ»å¼€å§‹æ’­æ”¾ï¼Œä¸èƒ½æš‚åœï¼›
- ä¸æ”¯æŒå¿«è¿›æ’­æ”¾ï¼Œä¹Ÿä¸å¯ä»¥å¾ªç¯æ’­æ”¾ï¼›
- åŒä¸€æ—¶åˆ»åªèƒ½æ’­æ”¾ä¸€ä¸ªéŸ³é¢‘ï¼›
- åªèƒ½é€šè¿‡æ‰‹æœºæ’­æ”¾éŸ³é¢‘ï¼Œä¸èƒ½é€šè¿‡å…¶å®ƒè®¾å¤‡è¾“å‡ºï¼Œæ¯”å¦‚ä¸èƒ½é€šè¿‡è½¦è½½æ’­æ”¾ã€‚

[æŸ¥çœ‹æ›´å¤šçš„ç³»ç»Ÿå£°éŸ³ID](http://iphonedevwiki.net/index.php/AudioServices)

[2] `AVAudioPlayer` æ’­æ”¾æœ¬åœ°çš„éŸ³é¢‘ï¼Œæˆ–è€…å·²åŠ è½½åˆ°å†…å­˜ä¸­çš„éŸ³é¢‘æµï¼Œä¸»è¦ç”¨äºæ’­æ”¾æœ¬åœ°çš„ä¸€äº›éŸ³é¢‘æ–‡ä»¶ã€‚æ³¨æ„å®ƒä¸èƒ½æ’­æ”¾ç½‘ç»œéŸ³é¢‘ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- å¯ä»¥ä»ä»»æ„ä½ç½®æ’­æ”¾ï¼Œå¯å¿«è¿›ï¼Œå¿«é€€ï¼›
- å¯ä»¥å¾ªç¯æ’­æ”¾ï¼›
- å¯ä»¥åŒæ—¶æ’­æ”¾å¤šä¸ªéŸ³é¢‘ï¼›
- å¯ä»¥æ§åˆ¶æ’­æ”¾é€Ÿç‡ï¼›

[3] `AVPlayer` å¯ä»¥æ’­æ”¾æœ¬åœ°å’Œç½‘ç»œéŸ³é¢‘ï¼Œä¹Ÿå¯ä»¥æ’­æ”¾è§†é¢‘ï¼Œå®ƒæ”¯æŒæµåª’ä½“æ’­æ”¾ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åšè¾¹ä¸‹åˆ«æ’­çš„ä½¿ç”¨åœºæ™¯ã€‚

[4] `AVQueuePlayer` æ˜¯ `AVPlayer` çš„å­ç±»ï¼Œå®ƒå«æœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸»è¦ç”¨æ¥æ’­æ”¾ä¸€ä¸ªéŸ³è§†é¢‘é˜Ÿåˆ—ã€‚

[5] `Audio Queue` ä¸»è¦ç”¨æ¥æ’­æ”¾éŸ³é¢‘ï¼Œå½•éŸ³ï¼Œå®ƒæ¯”è¾ƒåº•å±‚ï¼Œä¼šæœ‰æ›´å¤šçš„æ§åˆ¶æƒï¼Œå¦‚æœ `APP` ä¸»è¦åŠŸèƒ½æ˜¯åŸºäºéŸ³é¢‘æ’­æ”¾ï¼Œæ¨èä½¿ç”¨è¿™ä¸ªã€‚

æ€»çš„æ¥è¯´ï¼Œå¦‚æœæ™®é€šçš„æœ¬åœ°éŸ³é¢‘æ’­æ”¾ï¼Œå¯ä»¥é€‰æ‹© `AVAudioPlayer` ï¼Œè¿™ä¸ªä¸éœ€è¦äº†è§£æ›´å¤šçš„éŸ³é¢‘çŸ¥è¯†ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¸€ä¸ªåŸºæœ¬çš„æ’­æ”¾ï¼›å¦‚æœæƒ³åšæµåª’ä½“æ’­æ”¾ï¼Œå»ºè®®ä½¿ç”¨ `AVPlayer + Local Server` çš„æ–¹å¼ï¼Œç±»ä¼¼äºå”±å§ç›®å‰å¼€æºçš„æ–¹å¼ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© `Audio Queue`ï¼Œä¸è¿‡è¿™ä¸ªéš¾åº¦æ¯”è¾ƒé«˜ï¼Œéœ€è¦å¯¹éŸ³é¢‘æ’­æ”¾æœ‰ä¸€ä¸ªæ•´ä½“çš„äº†è§£ï¼Œæ¨èä½¿ç”¨ä¸‰æ–¹åº“ `FreeStream`ï¼Œä¸è¿‡éœ€è¦ä¸€äº› `C++` çš„çŸ¥è¯†ï¼Œå› ä¸ºä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰ä¸€äº›å‘éœ€è¦å¡«ï¼Œè¿™æ ·ä¸å¾—ä¸é˜…è¯»æºç ã€‚æœ€åæ¨èä¸€äº›ä¸é”™çš„æ–‡ç« ã€‚

[å®˜æ–¹ Audio Queue](https://developer.apple.com/library/content/documentation/MusicAudio/Conceptual/AudioQueueProgrammingGuide/AQPlayback/PlayingAudio.html#//apple_ref/doc/uid/TP40005343-CH3-SW1)

[å®˜æ–¹ AudioSession](https://developer.apple.com/library/content/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007875)

[@ppé”…çš„ç å†œç”Ÿæ´» åšå®¢](https://brownfeng.github.io/2016/07/25/iOS%E9%9F%B3%E9%A2%91%E7%B3%BB%E5%88%97(%E4%B8%80)/)

[@cy_zju åšå®¢](http://msching.github.io/blog/2014/07/08/audio-in-ios-2/)


iOSä¸­NSArray/NSSetçš„ä¸€äº›å·§å¦™ç”¨æ³•
--------

**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

æœ€è¿‘ç”¨åˆ°å¾ˆå¤šæ“ä½œé›†åˆç±»å‹çš„æ–¹æ³•ï¼Œè¿™é‡Œæ€»ç»“åˆ†äº«ä¸€ä¸‹ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸€èµ·è¡¥å……ã€‚

* å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ª `NSArray<Model *>` ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³æŠŠè¿™ä¸ªæ•°ç»„ä¸­çš„ `Model` çš„æŸä¸ªå±æ€§å–å‡ºç»„æˆä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯èƒ½æ˜¯ç›´æ¥å»éå†ï¼Œä½†æ˜¯ `NSArray/NSSet` æœ‰ä¸€ä¸ªæ›´ä¾¿æ·çš„æ–¹æ³• `valueForKey:`,å¯ä»¥å¿«é€Ÿå–å‡ºå¯¹åº”å±æ€§ç»„æˆçš„æ•°ç»„ã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ•ˆç‡æ¯” `for` å¾ªç¯ä½ï¼Œæ•°æ®é‡ä¸å¤§çš„æ—¶å€™ä½¿ç”¨è¿˜æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å¦‚ä¸‹é¢ä¸¤å¼ å›¾ï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/4-1.jpg?raw=true)

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/4-2.jpg?raw=true)

* è¦å–ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆå°† `NSArray` è½¬æ¢æˆ `NSMutableSet`ï¼Œå†é€šè¿‡å–äºŒè€…äº¤é›†å³å¯ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ æœ€å¥½å¤å†™ä¸€ä¸‹ `isEqual:` å’Œ `hash` æ–¹æ³•ï¼Œä¿è¯å–äº¤é›†åçš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚

* è¦å°†æ•°ç»„å†…å…ƒç´ æ’åºæˆ–è€…è¿‡æ»¤ç­‰æ“ä½œï¼Œå¯ä»¥ç»“åˆ `NSSortDescriptor` å’Œ `NSPredicate` ä½¿ç”¨ï¼Œå¯ä»¥é¿å…æ‰å¤§é‡å†—ä½™çš„ `for` å¾ªç¯ä¹‹ç±»çš„ä»£ç ã€‚å…³äº `NSPredicate` çš„ç”¨æ³•å¯ä»¥å‚è€ƒ [NSHipster](http://nshipster.com/nspredicate/) å’Œ `Realm` çš„ [Cheetsheet](https://academy.realm.io/posts/nspredicate-cheatsheet/)

* å…³äºå›¾ä¸­ `valueForKey:` çš„å‚æ•°ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ `@"name"` è€Œæ˜¯ç”¨ `NSStringFromSelector(@selector(name))`ï¼Œæ˜¯å› ä¸ºåè€…ä¼šæœ‰ä»£ç æç¤ºå¯ä»¥é¿å…ç¡¬ç¼–ç å¸¦æ¥çš„é”™è¯¯ï¼ŒåŒæ—¶åç»­è¯¥ `key` æ¢åå­—äº†ä¹‹åï¼Œä¼šæœ‰å¯¹åº”çš„è­¦å‘Šã€‚è¿™ä¸ªä¹Ÿæ˜¯ä» `AFNetworking` ä¸­å­¦åˆ°çš„ã€‚å¦‚å›¾æ‰€ç¤ºï¼š

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/4-3.jpg?raw=true)

å¯¹æ¸…é™¤å›¾ç‰‡ç¼“å­˜çš„æ€è€ƒ
--------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

ä¼—æ‰€å‘¨çŸ¥ï¼Œä½¿ç”¨ `+[UIImage imageNamed:]` æ–¹æ³•åŠ è½½å›¾ç‰‡æ˜¯ä¼šè¿›å›¾ç‰‡ç¼“å­˜çš„ï¼Œæ¸…é™¤ç¼“å­˜æ˜¯ç³»ç»Ÿè§¦å‘ï¼Œå¹¶æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›APIï¼›ä½¿ç”¨ `+[UIImage imageWithContentsOfFile:]` æ–¹æ³•åŠ è½½å›¾ç‰‡æ˜¯ä¸ä¼šè¿›å…¥å›¾ç‰‡ç¼“å­˜çš„ã€‚å¦‚æœæƒ³è¦æœ‰å›¾ç‰‡ç¼“å­˜æœºåˆ¶ï¼Œå¹¶ä¸”èƒ½æ‰‹åŠ¨æ¸…é™¤å›¾ç‰‡ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š

ä» `+[UIImage imageWithContentsOfFile:]` æ–¹å‘ä¸‹æ‰‹ï¼š
æˆ‘ä»¬å¯ä»¥è‡ªå·±ç»´æŠ¤ä¸€å¥—å›¾ç‰‡ç¼“å­˜ï¼Œ`Swizzle +[UIImage imageWithContentsOfFile:]` æ–¹æ³•åŠ å…¥ç¼“å­˜æœºåˆ¶ã€‚åŠ è½½å›¾ç‰‡åï¼ŒåŠ å…¥åˆ° `NSCache` ç¼“å­˜ï¼Œå†æ¬¡å–è¯¥å›¾ç‰‡æ—¶ï¼Œä¼˜å…ˆå– `NSCache` å†…çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å†…æ²¡æœ‰å†å»çœŸæ­£åŠ è½½ã€‚`NSCache`åœ¨ `Memory Warning` çš„æ—¶å€™ä¼šè‡ªåŠ¨æ¸…é™¤ç¼“å­˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `-[NSCache removeAllObjects]` æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ `Swizzle` ï¼Œå†™ä¸€ä¸ª `Manager` ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘åªæ˜¯æä¾›ä¸€ç§æ€è·¯ã€‚

ä» `+[UIImage imageNamed:]` æ–¹å‘ä¸‹æ‰‹ï¼š
åœ¨ `Memory Warning` æˆ–è¿›å…¥åå°æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ¸…é™¤ä½¿ç”¨ `+[UIImage imageNamed:]` çš„å›¾ç‰‡ç¼“å­˜ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ‹Ÿå‘é€ `UIApplicationDidReceiveMemoryWarningNotification` æˆ– `UIApplicationDidEnterBackgroundNotification` æ¥æ¸…é™¤å›¾ç‰‡ç¼“å­˜ï¼Œé£é™©å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥è¯„ä¼°ã€‚

è¿˜å¯ä»¥ä»ç§æœ‰APIæ¥ä¸‹æ‰‹ï¼Œ`+[UIImage imageNamed:]` ç³»ç»Ÿåº•å±‚æ˜¯é€šè¿‡ `UIAssetManager` æ¥ç®¡ç†å›¾ç‰‡ç¼“å­˜çš„ï¼Œå¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿè°ƒç”¨ `_clearCachedResources` æ–¹æ³•æ¥å®ç°æ¸…é™¤ç¼“å­˜ã€‚

å¦‚æœæœ‰å…¶ä»–æ€è·¯çš„ï¼Œæ¬¢è¿æå‡ºï¼

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/5-1.jpg?raw=true)
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/5-2.jpg?raw=true)


æ‰“å°Appä¸­åŠ è½½çš„åº“
--------

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)

ä¹‹å‰åˆ†äº«è¿‡é…ç½®ç¯å¢ƒå˜é‡ DYLD_PRINT_STATISTICSï¼Œæ¥åœ¨æ§åˆ¶å°æ‰“å°å‡ºç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­å„ä¸ªé˜¶æ®µæ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ä»Šå¤©å†åˆ†äº«ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼šDYLD_PRINT_LIBRARIES å’Œ DYLD_PRINT_LIBRARIES_POST_LAUNCHï¼Œè¿™ä¸¤ä¸ªå˜é‡ç”¨äºæ‰“å° dyld åŠ è½½çš„åº“ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼š

```objc
dyld: loaded: /var/containers/Bundle/Application/717397DD-AE3E-457F-A446-609883FF865C/ChangeIcon.app/ChangeIcon
dyld: loaded: /Developer/usr/lib/libBacktraceRecording.dylib
dyld: loaded: /Developer/usr/lib/libMainThreadChecker.dylib
dyld: loaded: /Developer/Library/PrivateFrameworks/DTDDISupport.framework/libViewDebuggerSupport.dylib
dyld: loaded: /System/Library/Frameworks/Foundation.framework/Foundation
dyld: loaded: /usr/lib/libobjc.A.dylib
dyld: loaded: /usr/lib/libSystem.B.dylib
dyld: loaded: /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation
dyld: loaded: /System/Library/Frameworks/UIKit.framework/UIKit
dyld: loaded: /usr/lib/libarchive.2.dylib
dyld: loaded: /usr/lib/libicucore.A.dylib
dyld: loaded: /usr/lib/libxml2.2.dylib
dyld: loaded: /usr/lib/libz.1.dylib
dyld: loaded: /System/Library/Frameworks/CFNetwork.framework/CFNetwork
dyld: loaded: /System/Library/Frameworks/SystemConfiguration.framework/SystemConfiguration
......
```

ä¸¤è€…çš„åŒºåˆ«åœ¨äº DYLD_PRINT_LIBRARIES ä¼šæ‰“å°å‡ºæ‰€æœ‰è¢«åŠ è½½çš„åº“ï¼Œè€Œ DYLD_PRINT_LIBRARIES_POST_LAUNCH æ‰“å°çš„æ˜¯é€šè¿‡ dlopen è°ƒç”¨è¿”å›çš„åº“ï¼ŒåŒ…æ‹¬åŠ¨æ€åº“çš„ä¾èµ–åº“ï¼Œä¸»è¦å‘ç”Ÿåœ¨ main å‡½æ•°è¿è¡Œä¹‹åã€‚

å‚è€ƒï¼š[Logging Dynamic Loader Events](https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/LoggingDynamicLoaderEvents.html)

è‡ªå®šä¹‰WebViewçš„UserAgent
--------

**ä½œè€…**: [_æ‹¿ç ´ä»‘çš„_é£ç«è½®_](https://weibo.com/u/2293476232)

1. äº§å“éœ€æ±‚:æ‰€æœ‰APPå†…çš„WebViewè®¿é—®çš„è‡ªå®¶æœåŠ¡, æ ¹æ® UserAgent è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºåˆé€‚çš„å†…å®¹.
2. æ€è·¯:è‡ªå®šä¹‰å…¨å±€çš„UserAgent.
3. å®ç°ä»£ç å¦‚ä¸‹:

```
/**
 * User-Agent æ ¼å¼å‚ç…§äº† AFNetworking è®¾ç½®
 */
- (void)customizeWebViewUserAgent {
    NSString *userAgent = nil;
    
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wgnu"
    // User-Agent Header; see http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.43
    userAgent = [NSString stringWithFormat:@"%@/%@ (%@-WebView; iOS %@; Scale/%0.2f)", [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleExecutableKey] ?: [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleIdentifierKey], [[NSBundle mainBundle] infoDictionary][@"CFBundleShortVersionString"] ?: [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleVersionKey], [[UIDevice currentDevice] model], [[UIDevice currentDevice] systemVersion], [[UIScreen mainScreen] scale]];
#pragma clang diagnostic pop
    
    if (userAgent) {
        if (![userAgent canBeConvertedToEncoding:NSASCIIStringEncoding]) {
            NSMutableString *mutableUserAgent = [userAgent mutableCopy];
            if (CFStringTransform((__bridge CFMutableStringRef)(mutableUserAgent), NULL, (__bridge CFStringRef)@"Any-Latin; Latin-ASCII; [:^ASCII:] Remove", false)) {//æŠŠä¸ç¬¦åˆASCIIç¼–ç çš„å­—ç¬¦,è½¬ç æˆASCIIç¼–ç æ ¼å¼
                userAgent = mutableUserAgent;
            }
        }
        
        [NSUserDefaults.standardUserDefaults registerDefaults:@{@"UserAgent": userAgent}];
    }
}

```

* UIWebView å’Œ WkWebView çš„é»˜è®¤ UserAgent æŠ“åŒ…å¦‚å›¾æ‰€ç¤º

    ![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/6-1.png?raw=true)
* è‡ªå®šä¹‰UserAgentå¦‚å›¾æ‰€ç¤º

    ![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/6-2.png?raw=true)

åŠ¨ç”»å®ç°ç«Ÿç„¶å¯ä»¥è¿™ä¹ˆç®€å•ï¼Œæ”¯æŒ NA ä¸ Web
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸€ä¸ªå¤æ‚çš„ç±»ä¼¼ Twitter ç‚¹èµåŠ¨ç”»ä½¿ç”¨ä¸€è¡Œä»£ç å°±å¯ä»¥å®Œæˆï¼Œè€Œä¸”åŸºæœ¬ä¸éœ€è¦è°ƒæ•´ä»€ä¹ˆå‚æ•°å°±å¯ä»¥è¾¾åˆ° UE çš„è¦æ±‚ï¼Œä»å‡ å¤©çš„å·¥ä½œé‡å¯ä»¥ç¼©çŸ­åˆ°å‡ åˆ†é’Ÿã€‚è€Œè¿™ä¸€åˆ‡å¤šäºäº† Lottieï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬å®ç°è¿™ä¸€åˆ‡ã€‚åªéœ€è¦æœ‰ä¸ªç”± Bodymovin å¯¼å‡ºçš„ Json æ–‡ä»¶ï¼Œå³å¯è½»æ¾å®ç° UE æä¾›çš„åŠ¨æ•ˆã€‚

Lottie æ˜¯ç”± [Airbnb](http://airbnb.io) å¼€æºçš„åº“ï¼Œå®ƒæ”¯æŒ iOS, macOSï¼Œ Android ï¼ŒReact Native å’Œ Webã€‚å®ƒä¸»è¦é€šè¿‡è§£æä¸€ä¸ªç”± Bodymovin å¯¼å‡ºçš„ Json æ–‡ä»¶ï¼Œç„¶ååœ¨ NA å’Œ Web ä¸Šæ¸²æŸ“åŠ¨ç”»ã€‚è€Œè¿™äº›åŠ¨ç”»æœ€åˆé€šè¿‡ Adobe After Effects è½¯ä»¶è®¾è®¡ã€‚

Adobe After Effectsç®€ç§°â€œAEâ€æ˜¯Adobeå…¬å¸æ¨å‡ºçš„ä¸€æ¬¾å›¾å½¢è§†é¢‘å¤„ç†è½¯ä»¶ï¼Œé€‚ç”¨äºä»äº‹è®¾è®¡å’Œè§†é¢‘ç‰¹æŠ€çš„æœºæ„ï¼ŒåŒ…æ‹¬ç”µè§†å°ã€åŠ¨ç”»åˆ¶ä½œå…¬å¸ã€ä¸ªäººåæœŸåˆ¶ä½œå·¥ä½œå®¤ä»¥åŠå¤šåª’ä½“å·¥ä½œå®¤ã€‚

Bodymovin æ˜¯ Adobe After Effects çš„ä¸€ä¸ªæ’ä»¶ï¼Œå¯ä»¥æŠŠé€šè¿‡ AE åšå‡ºçš„åŠ¨ç”»ï¼Œå¯¼å‡ºä¸º Json æ–‡ä»¶ï¼Œè€Œ Lottie ç›´æ¥ä½¿ç”¨å¯¼å‡ºçš„ Json æ–‡ä»¶åœ¨æ‰‹æœºç«¯æ¸²æŸ“åŠ¨ç”»ã€‚

çœ‹çœ‹å…·ä½“çš„ä¸€ä¸ª Twitter ç‚¹èµåŠ¨ç”»å®ä¾‹ï¼š

```
LOTAnimatedSwitch *heartIcon = [LOTAnimatedSwitch switchNamed:@"TwitterHeart"];
heartIcon.frame = CGRectMake(100, 100, 200, 200);
[self.view addSubview:heartIcon];
```
Lottie å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªåŠ¨ç”»è§†å›¾æ·»åŠ åˆ°å¦ä¸€ä¸ªè§†å›¾ä¸Šï¼Œæ—¢å¯ä»¥å®Œæˆæ˜¾ç¤ºã€‚è€Œå®ƒçš„åŸç†å°±æ˜¯é€šè¿‡è§£æ Json æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª LOTComposition ç±»ï¼Œæ¥ç®¡ç†åŠ¨ç”»æ‰€éœ€è¦çš„å‚æ•°ï¼Œç„¶ååˆ©ç”¨åŸç”Ÿç±»å®ç°åŠ¨ç”»æ•ˆæœã€‚ç›®å‰ä¸»è¦æ”¯æŒçš„åŠ¨ç”»ç‰¹æ€§æœ‰ï¼š

1. è½¬åœºåŠ¨ç”»ï¼›
2. é€šè¿‡ Json æ–‡ä»¶æ¸²æŸ“åŠ¨ç”»ï¼›
3. å¯ä»¥é€šè¿‡ä¸€ä¸ªåŠ¨ç”»æ’­æ”¾å™¨æ¥æ’­æ”¾åŠ¨ç”»ï¼Œæ‹–åˆ°è¿›åº¦æ¡ï¼ŒæŸ¥çœ‹åŠ¨ç”»çš„å®ç°ï¼Œè¿™å¯¹è‡ªå·±å®ç°ä¸€ä¸ªåŸç”ŸåŠ¨ç”»éå¸¸æœ‰å¸®åŠ©ï¼›
4. åœ¨è¿è¡Œæ—¶ä¿®æ”¹åŠ¨ç”»ï¼›

å…³äºæ–­è¨€çš„ä¸€äº›ç”¨æ³•å’Œå‘
--------

**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ä¼šå†™ä¸€äº›æ–­è¨€æ¥å‘ç°è°ƒè¯•é˜¶æ®µçš„ä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œä½†æ˜¯è¿™äº›å¼‚å¸¸æƒ…å†µä¸Šçº¿åæ˜¯ä¸åº”è¯¥å±•ç¤ºç»™ç”¨æˆ·æˆ–è€…è®©ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ã€‚

é€šå¸¸ä½¿ç”¨ NSAssert æˆ–åŸºäºå®ƒçš„å®ã€‚Xcode 4.2ä¹‹ååœ¨ release æ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨å°†æ‰€æœ‰çš„ NSAssert ä¼˜åŒ–æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œrelease æ¨¡å¼ä¸‹ï¼ŒNSAssert ä¸ä¼šè¢«ç¼–è¯‘åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å»ï¼Œä¸»è¦æ˜¯é€šè¿‡è¿™ä¸ªå® NS_BLOCK_ASSERTIONS æ¥å®ç°çš„ã€‚
ä½†æ˜¯é¡¹ç›®ä¸­æ¥å…¥çš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…å…¶å®ƒå›¢é˜Ÿæä¾›çš„åº“ï¼Œæ— æ³•ä¿è¯ä»–ä»¬ä¹Ÿç”¨ NSAssertï¼Œå†™Cè¯­è¨€çš„å·¥ç¨‹å¸ˆä¸€èˆ¬æ˜¯ç”¨ assert æ¥åšæ–­è¨€å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œå°±æ¥å‘äº†ã€‚å…·ä½“å‘ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š

1ã€assert åœ¨ release ä¸‹ Xcode æ˜¯ä¸ä¼šè‡ªåŠ¨å°†è¿™äº›æ–­è¨€ç§»é™¤ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¼è‡´æ­£å¼ç”Ÿäº§ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€äº›å¼‚å¸¸(å´©æºƒ)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Building Settings -> æœç´¢â€œPreprocessor Macrosâ€ æ‰¾åˆ° release æ¨¡å¼ï¼ŒåŒå‡»ï¼Œç„¶åæ·»åŠ ï¼Œè¾“å…¥ NDEBUG=1 å³å¯ã€‚å¦‚å›¾æ‰€ç¤º

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/7-1.jpg?raw=true)

2ã€è¯´å®Œç¬¬ä¸€ä¸ªå‘ï¼Œåˆæ¥åˆ°ç¬¬äºŒä¸ªï¼Œå¦‚æœ pod é‡Œé¢ä¹Ÿæœ‰ç”¨åˆ° assertï¼Œä¸Šè¿°æ­¥éª¤å¯¹ pod æ— æ•ˆã€‚è§£å†³æ–¹æ¡ˆå¦‚å›¾

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/7-2.jpg?raw=true)

å°±æ˜¯ pod install ä¹‹åæŠŠæ¯ä¸ª pod çš„ target çš„ release æ¨¡å¼æ·»åŠ  NDEBUG=1ã€‚æˆ–è€…ä¹Ÿå¯ä»¥åœ¨ podspec é‡Œé¢æ·»åŠ å¯¹åº”çš„ GCC_PREPROCESSOR_DEFINITIONS å®šä¹‰ï¼Œä¸è¿‡ç”±äºæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œå¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼ˆè‡ªå·±ç»´æŠ¤çš„ pod å¦è¯´ï¼‰ã€‚

å‚è€ƒé“¾æ¥ï¼š[NSHipster](http://nshipster.com/nsassertionhandler/)ã€[Stackoverflow](https://stackoverflow.com/a/7887526)


è¯ä¹¦å‹¿éšæ„Revoke
--------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

ç”¨`InHouse`è¯ä¹¦æ‰“äº†ä¸€ä¸ªåŒ…ï¼Œå½“`InHouse`è¯ä¹¦è¿‡æœŸåï¼Œå·²ç»å®‰è£…äº†è¿™ä¸ªåŒ…çš„ç”¨æˆ·è¿˜å¯ä»¥ç»§ç»­æ­£å¸¸ä½¿ç”¨ï¼Œä½†ç”¨æˆ·æƒ³å…¨æ–°å®‰è£…æˆ–è€…è¦†ç›–å®‰è£…è¿™ä¸ªåŒ…å°±ä¼šå¤±è´¥ï¼›å¦‚æœ`InHouse`è¯ä¹¦ä¸æ˜¯è‡ªç„¶è¿‡æœŸï¼Œè€Œæ˜¯æ‰‹åŠ¨`Revoke`ï¼Œé‚£ä¹ˆæ³¨æ„å•¦ï¼Œç”¨æˆ·ä¸ä»…ä¸èƒ½å®‰è£…è¿™ä¸ªåŒ…ï¼Œè¿˜ä¼šå½±å“å·²ç»å®‰è£…äº†è¿™ä¸ªåŒ…çš„ç”¨æˆ·ï¼Œå¯åŠ¨å°±ä¼šé—ªé€€ï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œå¦‚æœæ­¤æ—¶ä½ æ­£åœ¨ç”¨è’²å…¬è‹±æˆ–è€…firç­‰ä¸‰æ–¹å¹³å°ç°æµ‹ï¼Œé‚£ä¹ˆå¯æƒ³è€ŒçŸ¥ã€‚ã€‚ã€‚ã€‚è™½ç„¶è¯´å‘å¸ƒè¯ä¹¦`Revoke`ä¸ä¼šå½±å“å·²ç»å‘å¸ƒåˆ°`AppStore`çš„åŒ…ï¼Œä½†æ˜¯ä¾æ—§ä¸æå€¡ï¼›å¦‚æœä½ éšæ„`Revoke`äº†ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨ä¸­çš„`Push`è¯ä¹¦ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œåœ¨ä½ ç”Ÿæˆæ–°çš„è¯ä¹¦ï¼Œ`Push`æœåŠ¡å™¨æ›´æ¢ä¹‹å‰ï¼Œä½ çš„ç”¨æˆ·å°±æ— æ³•æ”¶åˆ°`Push`å•¦ã€‚`Revoke`éœ€è°¨æ…ï¼Œä¸”è¡Œä¸”çæƒœï¼æä¸å¥½ï¼Œå°±ä¼šå½±å“ä¸€å¤§æ‰¹ç”¨æˆ·ã€‚ã€‚ã€‚ã€‚


åŠ¨æ€åŠ è½½Framework/Library
--------

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)

åœ¨å¼€å‘ `Framework/Library` æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ `Demo` ä¸­æµ‹è¯•ä¸åŒç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚å¦‚æœæ¯æ¬¡éƒ½åœ¨ `Demo` çš„ `Build Phase` ä¸­åˆ‡æ¢ `Framework/Library` çš„ä¸åŒç‰ˆæœ¬ï¼Œæ˜¯ä»¶å¾ˆéº»çƒ¦çš„äº‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ `Framework/Library`ã€‚æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨ `"dlfcn.h"` ä¸­çš„ `dlopen` å‡½æ•°ï¼š

```objc
void *framework1Handle = dlopen("DynamicFramework1.framework/DynamicFramework1", RTLD_LAZY);
```

`dlopen` æœ‰ä¸€ä¸ªå¯¹åº”çš„æ–¹æ³• `dlclose` ç”¨äºå¸è½½åº“ï¼Œä¸è¿‡åœ¨ `iOS` ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•ä¼¼ä¹ä¸èµ·ä½œç”¨ã€‚å› æ­¤åœ¨åŒä¸€æ¬¡è¿è¡Œæ—¶ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥åˆ‡æ¢ `Framework/Library` çš„ä¸åŒç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šå‡ºç°å¦‚å›¾çš„æç¤ºã€‚å®é™…ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ä»£ç æ— æ³•ç¡®å®šã€‚

```objc
objc[10662]: Class CASHello is implemented in both /private/var/containers/Bundle/Application/73362515-9CCA-47E0-B709-49BA437935DC/ios-dynamic-loading-framework.app/Frameworks/DynamicFramework1.framework/DynamicFramework1 (0x105680178) and /private/var/containers/Bundle/Application/73362515-9CCA-47E0-B709-49BA437935DC/ios-dynamic-loading-framework.app/Frameworks/DynamicFramework2.framework/DynamicFramework2 (0x105694178). One of the two will be used. Which one is undefined.
```

å˜é€šçš„æ–¹æ¡ˆæ˜¯åœ¨å¯åŠ¨æ—¶æä¾›ä¸€ä¸ªé€‰æ‹©é¡µé¢ï¼Œé€‰æ‹©åœ¨è¿è¡Œ `App` æ—¶ï¼Œä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ `Framework/Library`ã€‚å¦‚æœè¦åˆ‡æ¢ç‰ˆæœ¬ï¼Œå†é‡æ–°å¯åŠ¨ `App` ã€‚

`dlopen` ä»…é™äºå¼€å‘é˜¶æ®µä½¿ç”¨ã€‚


ç¼“å­˜ NSDateFormatter
--------

**ä½œè€…**: [_æ‹¿ç ´ä»‘çš„_é£ç«è½®_](https://weibo.com/u/2293476232)

ä¸ºä»€ä¹ˆè¦ç¼“å­˜ `NSDateFormatter` ?

> Creating a date formatter is not a cheap operation. If you are likely to use a formatter frequently, it is typically more efficient to cache a single instance than to create and dispose of multiple instances. One approach is to use a static variable.
> [developer.apple.com](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfDateFormatting10_4.html)


æ€è·¯: åˆ©ç”¨ `NSCache`, ä»¥ stringFormatter+NSLocaleçš„localeIdentifier ä¸ºkeyç¼“å­˜ `NSDateFormatter`. å½“`UIApplicationDidReceiveMemoryWarningNotification` æˆ– `NSCurrentLocaleDidChangeNotification` é‡Šæ”¾ `NSCache` ç¼“å­˜çš„å¯¹è±¡.

ä»£ç å‚è€ƒ[code](https://github.com/BrooksWon/BTNSDateFormatterFactory/blob/master/BTNSDateFormatterFactory/BTNSDateFormatterFactory.m),  æ ¸å¿ƒå®ç°ä»£ç å¦‚ä¸‹:

```
- (NSDateFormatter *)dateFormatterWithFormat:(NSString *)format andLocale:(NSLocale *)locale {
    @synchronized(self) {
        NSString *key = [NSString stringWithFormat:@"%@|%@", format, locale.localeIdentifier];
        
        NSDateFormatter *dateFormatter = [loadedDataFormatters objectForKey:key];
        if (!dateFormatter) {
            dateFormatter = [[NSDateFormatter alloc] init];
            dateFormatter.dateFormat = format;
            dateFormatter.locale = locale;
            [loadedDataFormatters setObject:dateFormatter forKey:key];
        }
        
        return dateFormatter;
    }
}
```


å®šæ—¶å™¨å¼•å‘çš„æ€è€ƒ
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

å½“ä½¿ç”¨ `AudioServicesPlaySystemSoundWithCompletion` æ’­æ”¾å®Œä¸€æ®µéŸ³é¢‘åï¼Œåœ¨å›è°ƒä¸­å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç„¶åå‘ç°å®šæ—¶å™¨ä¸æ‰§è¡Œï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼š

```
AudioServicesPlaySystemSoundWithCompletion(sysSoundID, ^{
    AudioServicesDisposeSystemSoundID(sysSoundID);
    NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(lefexTimerAction:) userInfo:nil repeats:YES];
});

- (void)lefexTimerAction:(NSTimer*)timer
{
   // è¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œ
}
```

å¦‚æœæˆ‘æŠŠä»£ç æ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå®šæ—¶å™¨å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯å‘ç°æ–¹æ³• `lefexTimerAction:` å¹¶ä¸åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨å¼€å¯å®šæ—¶å™¨å¯¹åº”çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š

```
AudioServicesPlaySystemSoundWithCompletion(sysSoundID, ^{
   AudioServicesDisposeSystemSoundID(sysSoundID);
   NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(handlePageStayTimer:) userInfo:nil repeats:YES];
   [[NSRunLoop currentRunLoop] run];
 });
```

çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½æ˜¯ä»€ä¹ˆåŸå› äº†ã€‚

ç³»ç»ŸéŸ³é¢‘æ’­æ”¾å®Œæˆåå›è°ƒå¹¶ä¸åœ¨ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¼€å¯å®šæ—¶å™¨æ—¶ä¸åœ¨ä¸»çº¿ç¨‹ã€‚Timer å’Œ runLoop æ˜¯ä¸€èµ·å·¥ä½œçš„ï¼Œæ²¡æœ‰ runLoopï¼Œå®šæ—¶å™¨ä¸èƒ½æ­£å¸¸æ‰§è¡Œã€‚è€Œç³»ç»Ÿä¸­åªæœ‰ mainRunLoop ä¼šé»˜è®¤å¼€å¯ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸»çº¿ç¨‹åˆ›å»ºå®šæ—¶å™¨å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„åŸå› ã€‚

runLoop ä¼šå¼ºå¼•ç”¨ timerï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„ä¸ºä»€ä¹ˆ timer ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå³ä½¿åœ¨ dealloc ä¸­é‡Šæ”¾ timerï¼Œä¹Ÿä¸èƒ½é¿å…å†…å­˜æ³„æ¼ï¼Œå› ä¸º dealloc å°±ä¸ä¼šæ‰§è¡Œã€‚

æŸ¥çœ‹ runLoop ä¸­çš„ timer ä¿¡æ¯å‘ç°ï¼Œå®ƒä¼šè®°å½• timer ä¸‹æ¬¡è¦æ‰§è¡Œçš„æ—¶é—´ï¼Œå½“ runLoop åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹ timer æ˜¯å¦éœ€è¦æ‰§è¡Œï¼Œè¿™ä¹Ÿå°±æ˜¯ timer ä¸å‡†çš„åŸå› ï¼Œå› ä¸ºæ¯ä¸€æ¬¡ runloop åæ‰ä¼šæ‰§è¡Œ timer çš„äº‹ä»¶ã€‚

```
{
  valid = Yes,
  firing = No,
  interval = 1,
  tolerance = 0,
  next fire date = 538315424 (-6.348737 @ 113761747014063),
  callout = (NSTimer) [Lefex handlePageStayTimer:],
  context = <CFRunLoopTimer context 0x600000226680>
 }
```

æ€»ç»“ï¼š
ä»ä¸Šé¢çš„é—®é¢˜æ¥çœ‹ï¼ŒNSTimerå¯¹å­¦ä¹  runLoop æœ‰å¾ˆå¤§å¸®åŠ©ã€‚runLoop å’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè€Œé™¤ä¸»çº¿ç¨‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹å¯¹åº”çš„ runLoop å¹¶æ²¡æœ‰åˆ›å»ºï¼Œå½“è°ƒç”¨ [NSRunLoop currentRunLoop] æ—¶ä¼šåˆ›å»ºè¿™ä¸ªçº¿ç¨‹å¯¹åº”çš„ runLoopï¼Œå®šæ—¶å™¨èƒ½è·‘èµ·æ¥çš„å‰ææ˜¯ runLoop å¿…é¡» runã€‚


å¦ä¸€ç§å½¢å¼å®šæ—¶å™¨
--------

**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

ä»æ˜¨å¤© @Lefe_x çš„åˆ†äº«æˆ‘ä»¬çŸ¥é“ NSTimer éœ€è¦é…åˆ runloop ä½¿ç”¨ï¼Œè€Œä¸”å®ƒè®¡æ—¶æ˜¯ä¸ç²¾ç¡®çš„ï¼ŒåŒæ—¶å¤„ç†ä¸å½“çš„æƒ…å†µä¸‹ä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚

ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹åŸºäº GCD çš„ Timerï¼Œå®ƒèƒ½è§£å†³æ‰åˆšåˆšæåŠåˆ°çš„ NSTimer çš„ä¸‰å¤§é—®é¢˜ã€‚å…ˆæ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œå¦‚å›¾ï¼Œå…·ä½“è§£é‡Šå·²ç»åŒ…å«åœ¨å›¾ä¸­äº†ã€‚

![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/15-1.jpg)

ä½†æ˜¯ä½¿ç”¨ dispatch_suspendã€dispatch_resume è¿™ä¸¤ä¸ªæ–¹æ³•éœ€è¦æ³¨æ„é…å¯¹ä½¿ç”¨ï¼Œä¸ç„¶å¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„â€œæƒŠ(å´©)å–œ(æºƒ)â€ã€‚å€¼å¾—ä¸€æçš„æ˜¯ dispatch source å¹¶æ²¡æœ‰æä¾›ç”¨äºæ£€æµ‹ source æœ¬èº«çš„æŒ‚èµ·è®¡æ•°çš„ APIï¼Œä¹Ÿå°±æ˜¯è¯´å¤–éƒ¨æ— æ³•å¾—çŸ¥å½“å‰ source çŠ¶æ€ã€‚è¿˜æœ‰å°±æ˜¯åˆ›å»º timer æœ€å¥½è¢«æŒæœ‰ï¼Œä¸ç„¶ dispatch_suspend ä¹‹åï¼Œå¦‚æœæ²¡æœ‰è¢«æŒæœ‰çš„è¯ï¼Œå°±ä¼š crashã€‚
å½“ dispatch_cancel è°ƒç”¨åï¼Œè¿™ä¸ª timer å°±å¤±æ•ˆäº†ï¼Œç±»ä¼¼ NSTimer çš„ invalidateã€‚

å…³äº GCD Timer æ¨èä¸€ä¸ªå¼€æºåº“:[SwiftTimer](https://github.com/100mango/SwiftTimer)

[å®˜æ–¹æ–‡æ¡£](http://t.cn/RQmIIpV)


å¼±æŒæœ‰å®¹å™¨æ–¹æ¡ˆ
--------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

åœ¨é€šçŸ¥è€…æ¨¡å¼ä¸­ï¼Œmangeræƒ³å¼±æŒæœ‰ä¸€äº›å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ

æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨`Foundation`ä¸ºå¤§å®¶æä¾›çš„å¼±æŒæœ‰å®¹å™¨ï¼š`NSHashTable`ã€`NSMapTable`ã€`NSPointerArray`ï¼Œåˆå§‹åŒ–æ—¶æŠŠ`option`è®¾ç½®æˆ`weak`å³å¯ï¼›

æ–¹æ¡ˆäºŒï¼šå¯ä»¥ä½¿ç”¨`CFFoundation`çš„`CFArrayCreateMutable`ç­‰æ¥åˆ›å»ºå®¹å™¨ï¼Œè¢«æ·»åŠ çš„å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸ä¼šåŠ 1ï¼›

æ–¹æ¡ˆä¸‰ï¼šå¯ä»¥å¦™ç”¨`NSValue`çš„`valueWithNonretainedObject`æ–¹æ³•ï¼Œè¢«æ·»åŠ çš„å¯¹è±¡ä¸éœ€è¦æœä»`NSCopying`åè®®ï¼›

æ–¹æ¡ˆå››ï¼šä½¿ç”¨æˆ‘ä»¬é€šå¸¸ç”¨çš„å¼ºæŒæœ‰å®¹å™¨ï¼Œè®©è¢«æ·»åŠ çš„å¯¹è±¡weakä¸€ä¸‹ï¼Œæ¯”å¦‚ä½¿ç”¨`__weak`å’Œ`block`é…åˆï¼šåœ¨`block`ä¸­è¿”å›weakå¯¹è±¡ã€‚

å¦‚æœæœ‰å…¶ä»–æ€è·¯çš„ï¼Œæ¬¢è¿æå‡ºï¼

è°ˆä¸€è°ˆiOSå¹³å°è·¨åŸŸè®¿é—®æ¼æ´
--------

**ä½œè€…**: [Lefe_x](https://weibo.com/u/5953150140)

æœ€è¿‘å¾ˆå¤šå…³äº iOS Webview æ¼æ´çš„è¯é¢˜ï¼Œåˆ©ç”¨è¿™ä¸ªæœºä¼šï¼Œæˆ‘ä¹Ÿæ¥è¯´è¯´å¯¹è¿™ä¸ªæ¼æ´çš„ç†è§£ï¼Œå¦‚æœæœ‰ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºï¼ŒåŒæ—¶æ„Ÿè°¢ @æŠ˜è…¾èŒƒå„¿_å‘³ç²¾ çš„æŒ‡ç‚¹ã€‚

iOSå¹³å°è·¨åŸŸè®¿é—®æ¼æ´æˆå› æ˜¯ç”±äº UIWebView é»˜è®¤å¼€å¯äº†WebKitAllowUniversalAccessFromFileURLs å’Œ WebKitAllowFileAccessFromFileURLsé€‰é¡¹ã€‚è¿™æ ·é»‘å®¢åˆ©ç”¨è¿™ä¸ªæ¼æ´ç»™æŸä¸ª APP ä¸‹å‘ä¸€ä¸ª HTML æ–‡ä»¶ï¼Œå½“ UIWebView ä½¿ç”¨ file åè®®æ‰“å¼€è¿™ä¸ª HTML æ–‡ä»¶ï¼Œè€Œ HTML æ–‡ä»¶ä¸­å«æœ‰ä¸€æ®µçªƒå–ç”¨æˆ·æ•°æ®çš„ JS ä»£ç ï¼Œè¿™æ ·å°±å¯¼è‡´ç”¨æˆ·æ•°æ®æ³„éœ²çš„å¯èƒ½ã€‚ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªæ¼æ´ï¼Œæˆ‘ç‰¹æ„å†™äº†ä¸€ä¸ª Demoï¼Œæˆªå›¾æ˜¯è¿è¡Œç»“æœã€‚

```
NSString *filePath = [[NSBundle mainBundle] pathForResource:@"index" ofType:@"html"];
_webView = [[UIWebView alloc] initWithFrame:self.view.bounds];
[_webView loadRequest:[NSURLRequest requestWithURL:[NSURL fileURLWithPath:filePath]]];
```

```
<!DOCTYPE html>
<html>
    <body>
        <script>
            // è¿™ä¸ªå¯ä»¥æ˜¯æ‰‹æœºä»»æ„ä¸€ä¸ªæ–‡ä»¶åœ°å€
            var localfile = "/etc/passwd"
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    alert(xhr.responseText);
                }
            }
           try {
              xhr.open("GET", localfile, true);
              xhr.send();
           } catch (ex) {
              alert(ex.message);
           }
        </script>
    </body>
</html>
```
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/17-1-1.jpg?raw=true)

è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œä¼šè¯»å–å‡ºæ‰‹æœºç«¯ /etc/passwd çš„æ–‡ä»¶ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´è®¿é—®å…¶ä»–åº”ç”¨çš„æ•°æ®ï¼Œè€Œä¸å¿…éœ€è¦ç”¨æˆ·çš„è®¸å¯ã€‚è€Œ WKWiebView çš„ WebKitAllowUniversalAccessFromFileURLs å’Œ WebKitAllowFileAccessFromFileURLs é»˜è®¤æ˜¯å…³é—­çš„ï¼Œä¸ä¼šå­˜åœ¨è¿™æ ·çš„é£é™©ã€‚

é‚£ä¹ˆå¦‚ä½•è§‰å¾—è‡ªå·±çš„ APP æ˜¯å¦æ˜¯å®‰å…¨çš„å‘¢ï¼Ÿçœ‹çœ‹æœ‰æ²¡æœ‰æ»¡è¶³ä¸‹é¢å‡ ç‚¹ï¼š
1. APP ä¸­æ˜¯å¦å«æœ‰è¿œç¨‹ä¸‹å‘çš„ html ä¾› APP åŠ è½½ï¼Œè€Œä¸­é€”ä¼šè¢«åˆ«äººç¯¡æ”¹ï¼›
2. åŠ è½½ HTML æ–‡ä»¶æ˜¯é€šè¿‡ file åè®®åŠ è½½çš„ï¼›
3. ä½¿ç”¨çš„æ˜¯å¦ä¸º UIWebViewï¼›
4. ä½¿ç”¨ WKWiebView æ˜¯å¦æœ‰ä¸»åŠ¨å¼€å¯ WebKitAllowUniversalAccessFromFileURLs å’Œ WebKitAllowFileAccessFromFileURLs è¿™ä¸¤ä¸ªå±æ€§ã€‚

ç¼–è¯‘æºæ–‡ä»¶çš„æµç¨‹
--------

**ä½œè€…**: [å—å³°å­_è€é©´](https://weibo.com/touristdiary)

æ¥å¤ä¹ ä¸€ä¸‹ç¼–è¯‘Objective-Cæºæ–‡ä»¶çš„è¿‡ç¨‹å§ã€‚ç”¨ä¸‹ã€Œ ç¼–è¯‘æºæ–‡ä»¶çš„æµç¨‹ ã€

æ¥å¤ä¹ ä¸€ä¸‹ç¼–è¯‘Objective-Cæºæ–‡ä»¶çš„è¿‡ç¨‹å§ã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤è¾“å‡ºç¼–è¯‘æºæ–‡ä»¶çš„ä¸åŒé˜¶æ®µï¼š

```c
clang -ccc-print-phases main.m
```

è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

```c
0: input, "main.m", objective-c
1: preprocessor, {0}, objective-c-cpp-output
2: compiler, {1}, ir
3: backend, {2}, assembler
4: assembler, {3}, object
5: linker, {4}, image
6: bind-arch, "x86_64", {5}, image
```

ç®€å•è§£é‡Šä¸€ä¸‹1-6çš„å¤„ç†ï¼š

1. é¢„å¤„ç†ï¼šå¤„ç†åŒ…æ‹¬å®æ›¿æ¢ã€å¤´æ–‡ä»¶å¯¼å…¥ï¼›
2. ç¼–è¯‘ç”ŸæˆIR(ä¸­é—´ä»£ç )ï¼šè¯æ³•åˆ†æã€ç”ŸæˆASTã€é™æ€åˆ†æç­‰ï¼Œç„¶åç”ŸæˆLLVMä»£ç ï¼›
3. æ±‡ç¼–å™¨ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼›
4. æ±‡ç¼–å™¨å°†å¯è¯»çš„æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨ä»£ç ï¼›
5. å°†å¤šä¸ªç›®æ ‡å¯¹è±¡æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼›
6. ç”Ÿæˆimageæ–‡ä»¶ï¼Œå³æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼›

å‚è€ƒ [æ·±å…¥å‰–æ iOS ç¼–è¯‘ Clang LLVM ](https://github.com/ming1016/study/wiki/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90-iOS-%E7%BC%96%E8%AF%91-Clang---LLVM)

ä½¿ç”¨AVCaptureSessionè¸©çš„ä¸€ä¸ªå‘
--------

**ä½œè€…**: [Vong_HUST](https://weibo.com/VongLo)

æœ€è¿‘é‡åˆ°ä¸€ä¸ªbugï¼Œåœºæ™¯æ˜¯è¿™æ ·çš„ï¼š
åº”ç”¨ä¸­æœ‰ä¸¤ä¸ªç›¸æœºç›¸å…³çš„é¡µé¢ï¼Œç›´æ’­é¡µå’Œç›´æ’­å°é¢æ‹æ‘„é¡µï¼ˆä¸¤ä¸ªé¡µé¢ç›¸æœºå®ä¾‹ä¸æ˜¯åŒä¸€ä¸ªï¼‰ï¼Œè¿›å…¥ç›´æ’­é¡µæ—¶ï¼Œè®¾ç½®äº† preset1ï¼ˆ16:9ï¼‰ï¼Œç‚¹å‡»è¿›å…¥å°é¢æ‹æ‘„ï¼Œä¼šä½¿ç”¨ preset2ï¼ˆ4:3ï¼‰ã€‚å¦‚æœç›´æ’­é¡µå’Œå°é¢æ‹æ‘„é¡µçš„æ‘„åƒå¤´ä½ç½®ä¸€è‡´ï¼Œä»å°é¢æ‹æ‘„é¡µè¿”å›åˆ°ç›´æ’­é¡µæ—¶ï¼Œä¼šå¯¼è‡´ç›¸æœºè¾“å‡ºçš„ç”»é¢å†…å®¹å˜å½¢ã€‚åé¢æ–­ç‚¹æŸ¥çœ‹ï¼Œåœ¨æ‘„åƒå¤´ä½ç½®ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä»å°é¢æ‹æ‘„é¡µè¿”å›åˆ°ç›´æ’­é¡µæ—¶ï¼Œç›´æ’­é¡µAVCaptureSessionçš„ preset å˜ä¸ºäº† AVCaptureSessionPresetInputPriorityï¼Œè€Œä¸å†æ˜¯ä¹‹å‰çš„è®¾ç½®çš„ preset1ã€‚

é€šè¿‡å®˜æ–¹æ–‡æ¡£ä»¥åŠ Google å‡ºçš„èµ„æ–™ï¼ŒAVCaptureSessionPresetInputPriority ä»£è¡¨ capture session ä¸å»æ§åˆ¶éŸ³é¢‘ä¸è§†é¢‘è¾“å‡ºè®¾ç½®ã€‚è€Œæ˜¯é€šè¿‡å·²è¿æ¥çš„æ•è·è®¾å¤‡çš„ activeFormat æ¥åè¿‡æ¥æ§åˆ¶ capture session çš„è¾“å‡ºè´¨é‡ç­‰çº§ã€‚æ”¾åˆ°æˆ‘ä»¬ä¸Šé¢çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆå›åˆ°ç›´æ’­æ‹æ‘„é¡µæ—¶ï¼Œpreset å˜æˆäº†å°é¢æ‹æ‘„æ—¶çš„ presetï¼ˆå³4:3çš„preset2ï¼‰ï¼Œè¿›è€Œå¯¼è‡´äº†è¾“å‡ºç”»é¢å˜å½¢ã€‚å…¶å®æƒ³æƒ³ä¹Ÿå¯¹ï¼Œè®¾å¤‡å…¨å±€æ˜¯åŒä¸€ä¸ªæ‘„åƒå¤´ï¼Œä¸Šä¸€æ¬¡çš„æ›´æ”¹çš„å‚æ•°å€¼ï¼Œåº”è¯¥æ˜¯ä¼šè¢«ä¿ç•™åˆ°ä¸‹ä¸€æ¬¡çš„ï¼Œæ‰€ä»¥ä¸‹ä¸€æ¬¡åœ¨ç”¨ä¹‹å‰æœ€å¥½åšä¸€æ¬¡åˆ¤æ–­æ˜¯å¦è¦é‡æ–°è®¾å€¼ã€‚

è§£å†³æ–¹æ¡ˆå°±æ˜¯æ¯æ¬¡ç›¸æœºé¡µé¢ viewDidAppear çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹ captureSession çš„ preset å’Œé¢„è®¾çš„å€¼æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´ï¼Œå†è®¾å›æ¥å³å¯ã€‚

ä»¥ä¸Šï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œä¸€èµ·äº¤æµæ¢è®¨ã€‚

å‚è€ƒé“¾æ¥ï¼šhttp://t.cn/R8fAZ37

åˆ©ç”¨ Custom event è§£å†³ä¸€ä¸ªå°é—®é¢˜
--------

**ä½œè€…**: [_æ‹¿ç ´ä»‘çš„_é£ç«è½®_](https://weibo.com/u/2293476232)

åšIMå¼€å‘æ—¶,æœ‰ä¸ªåœºæ™¯æ˜¯:æ•°æ®å¼‚æ­¥å¤„ç†,å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UIã€å±•ç¤ºæ¶ˆæ¯ç»™ç”¨æˆ·çœ‹åˆ°.å½“ç”¨æˆ·çŸ­æ—¶é—´å†…æ”¶åˆ°å¾ˆå¤šæ¡æ¶ˆæ¯æ—¶,æˆ‘ä»¬ä¸æƒ³å¯¹UIè¿›è¡Œé¢‘ç¹è€Œç´¯èµ˜çš„æ›´æ–°,ç†æƒ³çš„æƒ…å†µæ˜¯å½“ä¸»çº¿ç¨‹ç¹å¿™æ—¶å°†æ‰€æœ‰çš„æ”¹å˜è”ç»“èµ·æ¥ã€‚æ­¤æ—¶,å¯ä»¥åˆ©ç”¨è”ç»“çš„ä¼˜åŠ¿(åœ¨å¼‚æ­¥çº¿ç¨‹ä¸Šè°ƒç”¨ `dispatch_source_merge_data` åï¼Œå°±ä¼šæ‰§è¡Œ dispatch source äº‹å…ˆå®šä¹‰å¥½çš„handler)ã€‚ä½¿ç”¨ `DISPATCH_SOURCE_TYPE_DATA_ADD`ï¼Œå°†åˆ·æ–°UIçš„å·¥ä½œæ‹¼æ¥èµ·æ¥ï¼ŒçŸ­æ—¶é—´å†…åšå°½é‡å°‘æ¬¡æ•°çš„åˆ·æ–°ã€‚

ä¼ªä»£ç 
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/20-1-1.jpg?raw=true)
æ‰§è¡Œç»“æœ
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/20-1-2.jpg?raw=true)

æ¬¢è¿å¤§å®¶åˆ†äº«å…¶ä»–æ€è·¯.

ç”¨xcconfigé…ç½®BuildSettings
--------

**ä½œè€…**: [é«˜è€å¸ˆå¾ˆå¿™](https://weibo.com/517082456)

å½“æˆ‘ä»¬é¡¹ç›®ä¸­æœ‰å¾ˆå¤šTargetï¼Œå¹¶ä¸”ä¸åŒConfigurationsä¸‹çš„é…ç½®ä¹Ÿä¸åŒçš„æ—¶å€™ï¼Œç›´æ¥é…ç½®BuildSettingsæ˜¯ä¸€ä»¶å¾ˆç—›è‹¦çš„äº‹æƒ…ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨`xcconfig`æ¥è§£è€¦äº†ã€‚`xcconfig`æ˜¯ç”¨æ¥ä¿å­˜BuildSettingsé”®å€¼å¯¹çš„çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å…±äº«å…¬ç”¨çš„é…ç½®ï¼Œåœ¨ä¸­å¤§å‹é¡¹ç›®ä¸­å¾ˆæ˜¯å®ç”¨ã€‚

æˆ‘ä»¬æ¥ä¸¾ä¸ªç®€å•æ —å­ğŸŒ°å§ï¼Œåˆ›å»º2ä¸ª`xcconfig`æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯`Common.xcconfig`ï¼ˆå…¬å…±è®¾ç½®ï¼‰,ä¸€ä¸ªæ˜¯`Debug.xcconfig`ï¼ˆDebugçš„æ—¶å€™ä½¿ç”¨çš„ï¼‰ï¼Œå¦‚å›¾1ï¼›
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/21-1-1.jpg?raw=true)
å¦‚å›¾2ï¼›
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/21-1-2.jpg?raw=true)
å¦‚å›¾3ï¼›
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/21-1-3.jpg?raw=true)

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»build Settingsé‡Œé¢å»æŸ¥çœ‹å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å†™å…¥çš„å†…å®¹äº†ï¼Œå¦‚å›¾4ã€‚
![](https://github.com/southpeak/iOS-tech-set/blob/master/images/2018/01/21-1-4.jpg?raw=true)


